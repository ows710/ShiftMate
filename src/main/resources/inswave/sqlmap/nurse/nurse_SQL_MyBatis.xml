<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="nurse">

	<!-- 간호사 정보 목록 조회 -->
	<select id="selectListNurse" parameterType="com.demo.proworks.nurse.vo.NurseVo" resultType="com.demo.proworks.nurse.vo.NurseVo">
		SELECT 
			NURSE_ID as nurseId,
			NURSE_NAME as nurseName,
			POSITION as position,
			CAREER as career,
			SPECIAL_NOTE as specialNote,
			REG_DATE as regDate,
			MOD_DATE as modDate,
			USE_YN as useYn,
			DEL_YN as delYn
		FROM NURSE_INFO
		WHERE DEL_YN = 'N'
		<if test="searchNurseName != null and searchNurseName != ''">
			AND NURSE_NAME LIKE '%' || #{searchNurseName} || '%'
		</if>
		<if test="searchPosition != null and searchPosition != ''">
			AND POSITION = #{searchPosition}
		</if>
		ORDER BY REG_DATE DESC
		<if test="pageSize > 0">
			LIMIT #{startIndex}, #{pageSize}
		</if>
	</select>

	<!-- 간호사 정보 목록 건수 조회 -->
	<select id="selectListCountNurse" parameterType="com.demo.proworks.nurse.vo.NurseVo" resultType="long">
		SELECT COUNT(*)
		FROM NURSE_INFO
		WHERE DEL_YN = 'N'
		<if test="searchNurseName != null and searchNurseName != ''">
			AND NURSE_NAME LIKE '%' || #{searchNurseName} || '%'
		</if>
		<if test="searchPosition != null and searchPosition != ''">
			AND POSITION = #{searchPosition}
		</if>
	</select>

	<!-- 간호사 정보 상세 조회 -->
	<select id="selectNurse" parameterType="com.demo.proworks.nurse.vo.NurseVo" resultType="com.demo.proworks.nurse.vo.NurseVo">
		SELECT 
			NURSE_ID as nurseId,
			NURSE_NAME as nurseName,
			POSITION as position,
			CAREER as career,
			SPECIAL_NOTE as specialNote,
			REG_DATE as regDate,
			MOD_DATE as modDate,
			USE_YN as useYn,
			DEL_YN as delYn
		FROM NURSE_INFO
		WHERE NURSE_ID = #{nurseId}
		AND DEL_YN = 'N'
	</select>

	<!-- 간호사 정보 등록 -->
	<insert id="insertNurse" parameterType="com.demo.proworks.nurse.vo.NurseVo">
		INSERT INTO NURSE_INFO (
			NURSE_ID,
			NURSE_NAME,
			POSITION,
			CAREER,
			SPECIAL_NOTE,
			REG_DATE,
			MOD_DATE,
			USE_YN,
			DEL_YN
		) VALUES (
			(SELECT COALESCE(MAX(NURSE_ID), 0) + 1 FROM NURSE_INFO),
			#{nurseName},
			#{position},
			#{career},
			#{specialNote},
			NOW(),
			NOW(),
			#{useYn},
			#{delYn}
		)
	</insert>

	<!-- 간호사 정보 수정 -->
	<update id="updateNurse" parameterType="com.demo.proworks.nurse.vo.NurseVo">
		UPDATE NURSE_INFO SET
			NURSE_NAME = #{nurseName},
			POSITION = #{position},
			CAREER = #{career},
			SPECIAL_NOTE = #{specialNote},
			MOD_DATE = NOW()
			<if test="useYn != null">
				, USE_YN = #{useYn}
			</if>
			<if test="delYn != null">
				, DEL_YN = #{delYn}
			</if>
		WHERE NURSE_ID = #{nurseId}
	</update>

	<!-- 간호사 정보 삭제 (물리 삭제) -->
	<delete id="deleteNurse" parameterType="com.demo.proworks.nurse.vo.NurseVo">
		DELETE FROM NURSE_INFO
		WHERE NURSE_ID = #{nurseId}
	</delete>

</mapper> 