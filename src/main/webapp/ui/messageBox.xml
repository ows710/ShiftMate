<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:w2="http://www.inswave.com/websquare" xmlns:xf="http://www.w3.org/2002/xforms">
    <head>
        <w2:type>COMPONENT</w2:type>
        <w2:buildDate/>
        <w2:MSA/>
        <xf:model>
            <w2:dataCollection baseNode="map">
                <w2:data id="ds_surgicalChart">
                    <w2:columnInfo>
                        <w2:column id="surgeryDate" type="string" size="256"/>
                        <w2:column id="ageGender" type="string" size="256"/>
                        <w2:column id="attendingDoctor" type="string" size="256"/>
                        <w2:column id="operatingRoom" type="string" size="256"/>
                        <w2:column id="heightWeight" type="string" size="256"/>
                        <w2:column id="surgeryStart" type="string" size="256"/>
                        <w2:column id="surgeryEnd" type="string" size="256"/>
                        <w2:column id="nurseInCharge" type="string" size="256"/>
                        <w2:column id="bloodType" type="string" size="256"/>
                        <w2:column id="anesthesiaStart" type="string" size="256"/>
                        <w2:column id="anesthesiaEnd" type="string" size="256"/>
                        <w2:column id="onDutyNurse" type="string" size="256"/>
                        <w2:column id="preOpHb" type="string" size="256"/>
                        <w2:column id="beforeSurgery" type="string" size="256"/>
                        <w2:column id="afterSurgery" type="string" size="256"/>
                    </w2:columnInfo>
                    <w2:rows>
                        <w2:row>
                            <w2:cell id="surgeryDate"></w2:cell>
                            <w2:cell id="ageGender"></w2:cell>
                            <w2:cell id="attendingDoctor"></w2:cell>
                            <w2:cell id="operatingRoom"></w2:cell>
                            <w2:cell id="heightWeight"></w2:cell>
                            <w2:cell id="surgeryStart"></w2:cell>
                            <w2:cell id="surgeryEnd"></w2:cell>
                            <w2:cell id="nurseInCharge"></w2:cell>
                            <w2:cell id="bloodType"></w2:cell>
                            <w2:cell id="anesthesiaStart"></w2:cell>
                            <w2:cell id="anesthesiaEnd"></w2:cell>
                            <w2:cell id="onDutyNurse"></w2:cell>
                            <w2:cell id="preOpHb"></w2:cell>
                            <w2:cell id="beforeSurgery"></w2:cell>
                            <w2:cell id="afterSurgery"></w2:cell>
                        </w2:row>
                    </w2:rows>
                </w2:data>
                <w2:data id="ds_vitalSigns">
                    <w2:columnInfo>
                        <w2:column id="time" type="string" size="256"/>
                        <w2:column id="bloodPressure" type="string" size="256"/>
                        <w2:column id="pulse" type="string" size="256"/>
                        <w2:column id="spo2" type="string" size="256"/>
                        <w2:column id="bodyTemp" type="string" size="256"/>
                        <w2:column id="ivFluid" type="string" size="256"/>
                        <w2:column id="urine" type="string" size="256"/>
                        <w2:column id="hemovac" type="string" size="256"/>
                        <w2:column id="medication" type="string" size="256"/>
                        <w2:column id="remarks" type="string" size="256"/>
                    </w2:columnInfo>
                    <w2:rows>
                        <w2:row>
                            <w2:cell id="time"></w2:cell>
                            <w2:cell id="bloodPressure"></w2:cell>
                            <w2:cell id="pulse"></w2:cell>
                            <w2:cell id="spo2"></w2:cell>
                            <w2:cell id="bodyTemp"></w2:cell>
                            <w2:cell id="ivFluid"></w2:cell>
                            <w2:cell id="urine"></w2:cell>
                            <w2:cell id="hemovac"></w2:cell>
                            <w2:cell id="medication"></w2:cell>
                            <w2:cell id="remarks"></w2:cell>
                        </w2:row>
                    </w2:rows>
                </w2:data>
            </w2:dataCollection>
            <w2:workflowCollection/>
        </xf:model>
        <w2:layoutInfo/>
        <w2:publicInfo method=""/>
        <style type="text/css">
            .chart-title {
                font-size: 24px;
                font-weight: bold;
                text-align: center;
                margin: 20px 0;
                color: #000;
            }
            .info-table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 20px;
            }
            .info-table td {
                border: 1px solid #ccc;
                padding: 8px;
                font-size: 14px;
            }
            .info-table .label {
                background-color: #f5f5f5;
                font-weight: bold;
                width: 120px;
            }
            .info-table .input-field {
                background-color: #fff;
                min-height: 20px;
            }
            .vital-signs-table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 20px;
            }
            .vital-signs-table th {
                background-color: #f5f5f5;
                border: 1px solid #ccc;
                padding: 10px;
                font-weight: bold;
                text-align: center;
                font-size: 14px;
            }
            .vital-signs-table td {
                border: 1px dotted #ccc;
                padding: 8px;
                text-align: center;
                font-size: 13px;
                min-height: 30px;
            }
            .group-header {
                background-color: #e8e8e8 !important;
                font-weight: bold;
            }
            .bottom-section {
                text-align: center;
                margin-top: 30px;
            }
            .date-line {
                font-size: 16px;
                margin-bottom: 10px;
            }
            .hospital-name {
                font-size: 18px;
                font-weight: bold;
                margin-top: 20px;
            }
        </style>
        <script lazy="false" type="text/javascript"><![CDATA[
scwin.onpageload = function() {
    // 페이지 로드 시 초기화
    this.initChart();
};

scwin.initChart = function() {
    // 현재 날짜 설정
    var today = new Date();
    var year = today.getFullYear();
    var month = today.getMonth() + 1;
    var day = today.getDate();
    
    // 하단 날짜 표시 업데이트
    var dateText = year + " 년 " + month + " 월 " + day + " 일";
    scwin.dateDisplay.setValue(dateText);
    
    // URL 파라미터에서 메시지 가져오기
    this.loadMessage();
};

scwin.loadMessage = function() {
    // URL 파라미터에서 메시지 추출
    var urlParams = new URLSearchParams(window.location.search);
    var message = urlParams.get('message');
    
    // 세션스토리지에서 메시지 확인
    if (!message) {
        message = sessionStorage.getItem('modalMessage');
    }
    
    // 메시지가 있으면 textarea에 표시
    if (message) {
        var textarea = document.getElementById('messageTextarea');
        if (textarea) {
            textarea.value = decodeURIComponent(message);
        }
    }
};

scwin.addVitalSignsRow = function() {
    // 활력징후 행 추가
    var ds = scwin.ds_vitalSigns;
    ds.addRow();
};

scwin.saveChart = function() {
    // 차트 저장 로직
    scwin.alert("수술간호차트가 저장되었습니다.");
};

scwin.closeModal = function() {
    // 모달 닫기 로직
    if (typeof parent !== 'undefined' && parent.closeModal) {
        parent.closeModal();
    } else {
        // 기본 닫기 동작
        window.close();
    }
};
]]></script>
    </head>
    <body ev:onpageload="scwin.onpageload">
        <div class="chart-title">수술간호차트</div>
        
        <!-- 상단 정보 섹션 -->
        <table class="info-table">
            <tr>
                <td class="label">수술날짜</td>
                <td class="input-field">
                    <w2:textbox id="surgeryDateInput" datafield="ds_surgicalChart.surgeryDate" style="width:100%; border:none; background:transparent;"/>
                </td>
                <td class="label">수술방</td>
                <td class="input-field">
                    <w2:textbox id="operatingRoomInput" datafield="ds_surgicalChart.operatingRoom" style="width:100%; border:none; background:transparent;"/>
                </td>
                <td class="label">담당 간호사</td>
                <td class="input-field">
                    <w2:textbox id="nurseInChargeInput" datafield="ds_surgicalChart.nurseInCharge" style="width:100%; border:none; background:transparent;"/>
                </td>
                <td class="label">당직 간호사</td>
                <td class="input-field">
                    <w2:textbox id="onDutyNurseInput" datafield="ds_surgicalChart.onDutyNurse" style="width:100%; border:none; background:transparent;"/>
                </td>
            </tr>
            
        </table>
        
        <!-- 메인 데이터 입력 섹션 -->
        <table class="vital-signs-table">
            <thead>
                <tr>
                    <th rowspan="2">시간</th>
                    <th colspan="4" class="group-header">활력징후</th>
                    <th rowspan="2" class="group-header">Intake</th>
                    <th colspan="2" class="group-header">Output</th>
                    <th rowspan="2" class="group-header">투약</th>
                    <th rowspan="2" class="group-header">비고</th>
                </tr>
                <tr>
                    <th>혈압</th>
                    <th>맥박</th>
                    <th>SpO2</th>
                    <th>체온</th>
                    <th>수액/수혈</th>
                    <th>소변</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="10" style="height: 400px; vertical-align: top; padding: 20px;">
                        <div style="width: 100%; height: 100%; border: 1px dotted #ccc; padding: 15px; background-color: #fafafa;">
                           
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        
        <!-- 하단 섹션 -->
        <div class="bottom-section">
            <div class="date-line">
                <w2:textbox id="dateDisplay" style="border:none; background:transparent; text-align:center; font-size:16px;"/>
            </div>
            <div class="hospital-name">
                삼육대학교병원
            </div>
        </div>
        
        <!-- 버튼 영역 -->
        <div style="text-align:right; margin-top:20px; padding-right:20px;">
            <w2:button id="confirmBtn" onclick="scwin.closeModal()" style="background-color:#e8e8e8; color:#000; border:1px solid #ccc; padding:12px 30px; border-radius:4px; font-size:16px; font-weight:bold; min-width:100px; height:40px;">확인</w2:button>
        </div>
    </body>
</html>
