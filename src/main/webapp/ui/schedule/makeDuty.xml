<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare"
	xmlns:xf="http://www.w3.org/2002/xforms">
	<head meta_screenName="듀티 자동 생성">
		<w2:type>COMPONENT</w2:type>
		<w2:buildDate />
		<w2:MSA />
		<style type="text/css">
			/* 기본 스타일 */
			* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			}

			body {
			font-family: 'Segoe
			UI', Tahoma, Geneva, Verdana,
			sans-serif;
			background-color: #f8f9fa;
			height: 100vh;
			overflow: auto;
			}

			/* 메인 컨테이너 */
			.main-container {
			width: 100%;
			min-height: 100vh;
			background-color: #f8f9fa; /* 배경색으로 구분감 추가 */
			overflow: visible; /* 스크롤 문제 방지 */
			padding-bottom: 30px; /* 하단 여백 */
			}

			/* 상단 컨트롤 영역 */
			.control-header {
			background: #f8f9fa;
			padding: 20px 30px;
			margin-bottom: 20px;
			border-bottom: 1px solid
			#e9ecef;
			box-shadow: 0
			2px 4px rgba(0,
			0, 0, 0.08);
			position: relative;
			z-index: 100;
			}

			.control-row {
			display:
			flex;
			padding: 0 25px;
			align-items: center;
			justify-content:
			space-between;
			margin-bottom:
			20px;
			}

			.control-left,
			.control-right {
			display: flex;
			align-items:
			center;
			gap: 15px;
			}

			/* 월 선택
			컨트롤 */
			.month-control {
			display: flex;
			align-items:
			center;
			gap: 8px;
			background: white;
			border-radius: 12px;
			padding:
			8px 12px;
			box-shadow: 0
			2px 8px rgba(28, 61, 107,
			0.2);
			border:
			2px solid
			#1C3D6B;
			}

			.month-arrow {
			width: 32px !important;
			height: 32px
			!important;
			background:
			#1C3D6B !important;
			color: white
			!important;
			border: none
			!important;
			border-radius: 6px !important;
			cursor: pointer
			!important;
			display: flex
			!important;
			align-items: center
			!important;
			justify-content: center !important;
			font-weight: bold !important;
			transition: all 0.2s ease
			!important;
			font-size: 14px
			!important;
			}

			.month-arrow:hover {
			background: #103E6B !important;
			transform: scale(1.05)
			!important;
			}

			.month-display {
			font-weight: 700
			!important;
			font-size: 16px !important;
			color: #1C3D6B !important;
			min-width: 100px !important;
			text-align:
			center !important;
			}

			/* 버튼 공통 스타일 */
			.btn {
			padding: 12px 24px !important;
			border: none !important;
			border-radius: 12px !important;
			font-weight: 600 !important;
			cursor: pointer
			!important;
			transition: all 0.3s ease !important;
			font-size: 14px !important;
			outline: none
			!important;
			}

			.btn:hover {
			background: #5C5DB0
			!important;
			transform: translateY(-2px) !important;
			}

			.btn-settings {
			background: #1C3D6B !important;
			color: #fff !important;
			}

			.btn-generate {
			background: #1C3D6B
			!important;
			color: #fff
			!important;
			font-weight: 700
			!important;
			}

			/* 모달 스타일 */
			.modal-overlay
			{
			position:
			fixed;
			top: 0;
			left: 0;
			width:
			100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.5);
			display: none;
			z-index: 1000;
			justify-content: center;
			align-items: center;
			}

			.modal-overlay.active {
			display: flex;
			}

			.modal-container {
			background: white;
			border-radius:
			12px;
			box-shadow: 0 10px 30px
			rgba(0, 0, 0, 0.3);
			width: 600px;
			max-height: 80vh;
			overflow-y: auto;
			}

			.modal-header {
			background: #1C3D6B;
			color:
			white;
			padding: 20px;
			border-radius: 12px 12px 0
			0;
			display:
			flex;
			justify-content: space-between;
			align-items: center;
			}

			.modal-title {
			font-size: 18px;
			font-weight:
			600;
			}

			.modal-close {
			background: none;
			border: none;
			color: white;
			font-size:
			24px;
			cursor: pointer;
			width: 30px;
			height: 30px;
			border-radius: 50%;
			}

			.modal-body {
			padding: 20px;
			max-height: 400px;
			overflow-y: auto;
			}

			.setting-section {
			margin-bottom: 25px;
			padding-bottom: 20px;
			border-bottom: 1px solid
			#e9ecef;
			}

			.setting-section:last-child {
			border-bottom:
			none;
			margin-bottom: 0;
			}

			.section-title {
			font-size: 16px;
			font-weight: 600;
			color:
			#1C3D6B;
			margin-bottom: 15px;
			}

			.setting-item {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 15px;
			padding: 12px;
			background: #f8f9fa;
			border-radius: 8px;
			}

			.setting-item:last-child {
			margin-bottom: 0;
			}

			.setting-label {
			font-weight: 500;
			color: #333;
			}

			.setting-description {
			font-size: 12px;
			color:
			#666;
			margin-top: 4px;
			}

			.setting-control {
			display: flex;
			align-items: center;
			gap:
			10px;
			}

			.number-input {
			width: 60px;
			padding: 6px 8px;
			border:
			1px solid #ddd;
			border-radius: 4px;
			text-align: center;
			font-weight: 600;
			}

			/* 토글 스위치 개선 */
			.toggle-switch {
			position: relative !important;
			width: 50px !important;
			height: 24px
			!important;
			background:
			#ccc !important;
			border-radius:
			12px !important;
			cursor: pointer !important;
			transition: background 0.3s ease
			!important;
			display: inline-block
			!important;
			user-select: none
			!important;
			}

			.toggle-switch:hover {
			background: #bbb !important;
			}

			.toggle-switch.active {
			background: #5CD6C0
			!important;
			}

			.toggle-switch.active:hover {
			background: #4ac5b0 !important;
			}

			.toggle-slider {
			position: absolute !important;
			top: 2px
			!important;
			left: 2px
			!important;
			width: 20px !important;
			height: 20px !important;
			background: white
			!important;
			border-radius: 50% !important;
			transition: transform
			0.3s ease !important;
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
			pointer-events: none !important;
			}

			.toggle-switch.active
			.toggle-slider {
			transform: translateX(26px) !important;
			}

			/* 설정 아이템 내부 정렬 개선 */
			.setting-control {
			display: flex;
			align-items: center;
			gap:
			10px;
			min-height: 30px; /* 최소 높이 보장 */
			}

			.modal-footer {
			padding:
			20px;
			border-top:
			1px
			solid
			#e9ecef;
			display: flex;
			justify-content:
			flex-end;
			gap:
			12px;
			}

			.btn-modal-cancel {
			background: #f8f9fa
			!important;
			color: #666
			!important;
			border: 1px solid #ddd
			!important;
			padding:
			10px 20px
			!important;
			border-radius: 6px
			!important;
			font-weight: 600
			!important;
			cursor: pointer
			!important;
			}

			.btn-modal-save {
			background:
			#5CD6C0
			!important;
			color: #1C3D6B
			!important;
			border:
			none !important;
			padding: 10px
			20px
			!important;
			border-radius:
			6px !important;
			font-weight: 600
			!important;
			cursor: pointer
			!important;
			}

			.violation-tooltip {
			position:
			absolute;
			background:
			rgba(0, 0, 0, 0.9);
			color:
			white;
			padding: 8px 12px;
			border-radius: 6px;
			font-size: 12px;
			font-weight: 500;
			z-index: 10000;
			max-width: 250px;
			word-wrap: break-word;
			box-shadow: 0 4px 12px
			rgba(0,0,0,0.3);
			pointer-events: none;
			white-space: nowrap;
			}

			.violation-tooltip::after {
			content: '';
			position:
			absolute;
			top: 100%;
			left: 50%;
			margin-left: -5px;
			border: 5px solid
			transparent;
			border-top-color: rgba(0, 0, 0, 0.9);
			}

			/* 중요 안내 메시지 추가 */
			.important-notice {
			background: #fff3cd;
			border: 1px solid #ffeaa7;
			border-radius: 4px;
			padding: 10px;
			margin: 15px 25px;
			color: #856404;
			font-size: 13px;
			text-align: center;
			}

			/* 상단 컨트롤 영역 */
			.control-header {
			background: #f8f9fa;
			padding: 20px
			30px;
			border-bottom:
			1px solid
			#e9ecef;
			box-shadow: 0 2px 4px rgba(0, 0, 0,
			0.08);
			position: relative;
			z-index: 100;
			margin-bottom:
			30px; /*
			피벗과의 여백 추가 */
			}

			/* 피벗 테이블
			영역 */
			.pivot-section {
			background: white;
			padding: 30px;
			/*
			내부 여백 추가 */
			box-shadow: 0 4px 20px
			rgba(0, 0, 0,
			0.08);
			border-radius: 12px; /* 모서리
			둥글게
			*/
			margin: 0 30px 30px 30px;
			}

			.section-content {
			width:
			100%;
			}

			/* 소계 섹션 스타일
			수정 */
			.summary-section {
			background: white;
			padding-left: 50px;
			}
			border-radius: 12px; /* 모서리 둥글게 */
			}

			.summary-grid-container {
			width: 100%;
			border-radius: 8px;
			box-shadow: 0 2px 8px rgba(0,
			0,
			0,
			0.1);
			}

			/* 진행률
			모달 스타일 */
			.progress-modal-overlay {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.5);
			display:
			none;
			z-index: 1000;
			justify-content: center;
			align-items: center;
			}

			.progress-modal-overlay.active {
			display: flex;
			}

			.progress-modal-container
			{
			background: white;
			border-radius: 12px;
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
			width: 700px;
			max-height: 80vh;
			overflow-y: auto;
			}

			.progress-modal-header {
			background: #1C3D6B;
			color: white;
			padding: 20px;
			border-radius: 12px 12px 0 0;
			text-align: center;
			}

			.progress-modal-title {
			font-size: 20px;
			font-weight: 600;
			margin-bottom: 10px;
			}

			.progress-modal-subtitle {
			font-size: 14px;
			opacity: 0.9;
			}

			.progress-modal-body {
			padding: 30px;
			}

			/*
			가이드라인 섹션 */
			.guideline-section {
			margin-bottom: 30px;
			}

			.guideline-title {
			font-size: 18px;
			font-weight: 600;
			color: #1C3D6B;
			margin-bottom:
			20px;
			display: flex;
			align-items: center;
			gap: 10px;
			}

			.guideline-icon {
			width: 24px;
			height:
			24px;
			background: #5CD6C0;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			color: white;
			font-weight: bold;
			font-size: 14px;
			}

			.guideline-item {
			display: flex;
			align-items: flex-start;
			gap: 12px;
			margin-bottom: 15px;
			padding: 15px;
			background: #f8f9fa;
			border-radius: 8px;
			border-left: 4px solid #5CD6C0;
			}

			.guideline-item-icon {
			width: 20px;
			height: 20px;
			background: #1C3D6B;
			border-radius: 4px;
			display: flex;
			align-items: center;
			justify-content: center;
			color: white;
			font-size: 12px;
			font-weight: bold;
			margin-top: 2px;
			}

			.guideline-item-content {
			flex: 1;
			}

			.guideline-item-title {
			font-weight: 600;
			color: #1C3D6B;
			margin-bottom: 5px;
			}

			.guideline-item-desc {
			font-size: 14px;
			color: #666;
			line-height: 1.4;
			}

			/* 진행률 바 스타일 (모달용) */
			.modal-progress-container {
			margin-bottom: 20px;
			}

			.modal-progress-bar-container {
			width: 100%;
			height: 12px;
			background: #C3F4E6;
			border-radius: 6px;
			overflow: hidden;
			margin-bottom: 10px;
			}

			.modal-progress-bar {
			height: 100%;
			background:
			linear-gradient(90deg, #5CD6C0 0%, #1C3D6B 100%);
			width: 0%;
			transition: width 1s ease;
			border-radius: 6px;
			}

			.modal-progress-text {
			text-align: center;
			font-weight: 600;
			color: #1C3D6B;
			font-size: 16px;
			}

			/* 성공 상태 스타일 */
			.success-content {
			text-align: center;
			padding: 20px;
			}

			.success-icon {
			width: 80px;
			height: 80px;
			background: #5CD6C0;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			margin: 0 auto 20px;
			font-size: 40px;
			color: white;
			}

			.success-title {
			font-size:
			24px;
			font-weight: 600;
			color: #1C3D6B;
			margin-bottom: 10px;
			}

			.success-message {
			font-size: 16px;
			color: #666;
			margin-bottom: 30px;
			}

			/* 모달 푸터 버튼
			*/
			.progress-modal-footer {
			padding: 20px;
			border-top: 1px
			solid #e9ecef;
			}

			.btn-close-modal {
			background: #5CD6C0 !important;
			color: #1C3D6B
			!important;
			border:
			none !important;
			padding:
			12px 30px
			!important;
			border-radius: 8px !important;
			font-weight: 600 !important;
			cursor: pointer
			!important;
			font-size: 16px !important;
			margin-left:
			550px;
			/* margin-left: 290px; 가운데 정렬 */
			}
		</style>
		<xf:model>
			<w2:dataCollection baseNode="map">
				<!-- 간호사 목록 데이터 -->
				<w2:dataList baseNode="list" id="dl_nurseList" repeatNode="map">
					<w2:columnInfo>
						<w2:column id="nurseId" name="간호사ID" dataType="text" />
						<w2:column id="nurseName" name="간호사명" dataType="text" />
						<w2:column id="experience" name="경력" dataType="number" />
						<w2:column id="isNightKeep" name="야간고정" dataType="number" />
					</w2:columnInfo>
					<w2:data use="true">
						<w2:row>
							<nurseId>
								1<![CDATA[1]]></nurseId>
							<nurseName>
								김간호<![CDATA[가]]></nurseName>
							<experience>60</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								2<![CDATA[2]]></nurseId>
							<nurseName>
								이수정<![CDATA[나]]></nurseName>
							<experience>58</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								3<![CDATA[3]]></nurseId>
							<nurseName>
								박지은<![CDATA[다]]></nurseName>
							<experience>58</experience>
							<isNightKeep>1</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								4<![CDATA[4]]></nurseId>
							<nurseName>
								윤서연<![CDATA[라]]></nurseName>
							<experience>47</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								5<![CDATA[5]]></nurseId>
							<nurseName>
								최유진<![CDATA[마]]></nurseName>
							<experience>45</experience>
							<isNightKeep>1</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								6<![CDATA[6]]></nurseId>
							<nurseName>
								김지수<![CDATA[바]]></nurseName>
							<experience>45</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								7<![CDATA[7]]></nurseId>
							<nurseName>
								정하윤<![CDATA[사]]></nurseName>
							<experience>44</experience>
							<isNightKeep>1</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								8<![CDATA[8]]></nurseId>
							<nurseName>
								한소민<![CDATA[아]]></nurseName>
							<experience>43</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								9<![CDATA[9]]></nurseId>
							<nurseName>
								오지민<![CDATA[자]]></nurseName>
							<experience>41</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								10<![CDATA[10]]></nurseId>
							<nurseName>
								이다은<![CDATA[차]]></nurseName>
							<experience>40</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								11<![CDATA[11]]></nurseId>
							<nurseName>
								박서진<![CDATA[카]]></nurseName>
							<experience>40</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								12<![CDATA[12]]></nurseId>
							<nurseName>
								조하늘<![CDATA[타]]></nurseName>
							<experience>39</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								13<![CDATA[13]]></nurseId>
							<nurseName>
								정윤아<![CDATA[파]]></nurseName>
							<experience>38</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								14<![CDATA[14]]></nurseId>
							<nurseName>
								김지연<![CDATA[하]]></nurseName>
							<experience>37</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								15<![CDATA[15]]></nurseId>
							<nurseName>
								송예진<![CDATA[아]]></nurseName>
							<experience>35</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								16<![CDATA[16]]></nurseId>
							<nurseName>
								강지우<![CDATA[야]]></nurseName>
							<experience>25</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								17<![CDATA[17]]></nurseId>
							<nurseName>
								이소율<![CDATA[어]]></nurseName>
							<experience>28</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								18<![CDATA[18]]></nurseId>
							<nurseName>
								문다현<![CDATA[여]]></nurseName>
							<experience>26</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								19<![CDATA[19]]></nurseId>
							<nurseName>
								서채원<![CDATA[오]]></nurseName>
							<experience>25</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								20<![CDATA[20]]></nurseId>
							<nurseName>
								유하진<![CDATA[요]]></nurseName>
							<experience>18</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								21<![CDATA[21]]></nurseId>
							<nurseName>
								정예린<![CDATA[우]]></nurseName>
							<experience>17</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								22<![CDATA[22]]></nurseId>
							<nurseName>
								이가은<![CDATA[유]]></nurseName>
							<experience>16</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								23<![CDATA[23]]></nurseId>
							<nurseName>
								김나영<![CDATA[으]]></nurseName>
							<experience>15</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								24<![CDATA[24]]></nurseId>
							<nurseName>
								안서윤<![CDATA[이]]></nurseName>
							<experience>14</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								25<![CDATA[25]]></nurseId>
							<nurseName>
								오세린<![CDATA[기]]></nurseName>
							<experience>5</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								26<![CDATA[26]]></nurseId>
							<nurseName>
								배수연<![CDATA[니]]></nurseName>
							<experience>5</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
						<w2:row>
							<nurseId>
								27<![CDATA[27]]></nurseId>
							<nurseName>
								오원석<![CDATA[디]]></nurseName>
							<experience>5</experience>
							<isNightKeep>0</isNightKeep>
						</w2:row>
					</w2:data>
				</w2:dataList>

				<!-- 생성된 스케줄 데이터 -->
				<w2:dataList baseNode="list" id="dl_scheduleData" repeatNode="map">
					<w2:columnInfo>
						<w2:column id="nurseId" name="간호사ID" dataType="text" />
						<w2:column id="nurseName" name="간호사명" dataType="text" />
						<w2:column id="shiftDate" name="근무일" dataType="text" />
						<w2:column id="shiftType" name="근무타입" dataType="text" />
						<w2:column id="isRequest" name="요청사항여부" dataType="boolean" />
						<w2:column id="hasViolation" name="위반사항여부" dataType="boolean" />
						<w2:column id="violationMsg" name="위반메시지" dataType="text" />
					</w2:columnInfo>
				</w2:dataList>

				<!-- 근무 형태 -->
				<w2:dataList baseNode="list" id="dl_shiftTypes" repeatNode="map">
					<w2:columnInfo>
						<w2:column id="value" name="값" dataType="text" />
						<w2:column id="label" name="표시명" dataType="text" />
					</w2:columnInfo>
					<w2:data use="true">
						<w2:row>
							<value>D</value>
							<label>D</label>
						</w2:row>
						<w2:row>
							<value>E</value>
							<label>E</label>
						</w2:row>
						<w2:row>
							<value>N</value>
							<label>N</label>
						</w2:row>
						<w2:row>
							<value>X</value>
							<label>X</label>
						</w2:row>
					</w2:data>
				</w2:dataList>

				<!-- 피벗 데이터 (31일 정적 컬럼) -->
				<w2:dataList baseNode="list" id="dl_pivotData" repeatNode="map" ev:oncelldatachange="scwin.dl_pivotData_oncelldatachange">
					<w2:columnInfo>
						<w2:column id="nurseId" name="간호사ID" dataType="text" />
						<w2:column id="nurseName" name="간호사명" dataType="text" />
						<w2:column id="day1" name="1일" dataType="text" />
						<w2:column id="day2" name="2일" dataType="text" />
						<w2:column id="day3" name="3일" dataType="text" />
						<w2:column id="day4" name="4일" dataType="text" />
						<w2:column id="day5" name="5일" dataType="text" />
						<w2:column id="day6" name="6일" dataType="text" />
						<w2:column id="day7" name="7일" dataType="text" />
						<w2:column id="day8" name="8일" dataType="text" />
						<w2:column id="day9" name="9일" dataType="text" />
						<w2:column id="day10" name="10일" dataType="text" />
						<w2:column id="day11" name="11일" dataType="text" />
						<w2:column id="day12" name="12일" dataType="text" />
						<w2:column id="day13" name="13일" dataType="text" />
						<w2:column id="day14" name="14일" dataType="text" />
						<w2:column id="day15" name="15일" dataType="text" />
						<w2:column id="day16" name="16일" dataType="text" />
						<w2:column id="day17" name="17일" dataType="text" />
						<w2:column id="day18" name="18일" dataType="text" />
						<w2:column id="day19" name="19일" dataType="text" />
						<w2:column id="day20" name="20일" dataType="text" />
						<w2:column id="day21" name="21일" dataType="text" />
						<w2:column id="day22" name="22일" dataType="text" />
						<w2:column id="day23" name="23일" dataType="text" />
						<w2:column id="day24" name="24일" dataType="text" />
						<w2:column id="day25" name="25일" dataType="text" />
						<w2:column id="day26" name="26일" dataType="text" />
						<w2:column id="day27" name="27일" dataType="text" />
						<w2:column id="day28" name="28일" dataType="text" />
						<w2:column id="day29" name="29일" dataType="text" />
						<w2:column id="day30" name="30일" dataType="text" />
						<w2:column id="day31" name="31일" dataType="text" />
					</w2:columnInfo>
				</w2:dataList>

				<!-- 소계 데이터 -->
				<w2:dataList baseNode="list" id="dl_summaryData" repeatNode="map">
					<w2:columnInfo>
						<w2:column id="shiftType" name="근무타입" dataType="text" />
						<w2:column id="shiftLabel" name="근무타입명" dataType="text" />
						<w2:column id="day1" name="1일" dataType="number" />
						<w2:column id="day2" name="2일" dataType="number" />
						<w2:column id="day3" name="3일" dataType="number" />
						<w2:column id="day4" name="4일" dataType="number" />
						<w2:column id="day5" name="5일" dataType="number" />
						<w2:column id="day6" name="6일" dataType="number" />
						<w2:column id="day7" name="7일" dataType="number" />
						<w2:column id="day8" name="8일" dataType="number" />
						<w2:column id="day9" name="9일" dataType="number" />
						<w2:column id="day10" name="10일" dataType="number" />
						<w2:column id="day11" name="11일" dataType="number" />
						<w2:column id="day12" name="12일" dataType="number" />
						<w2:column id="day13" name="13일" dataType="number" />
						<w2:column id="day14" name="14일" dataType="number" />
						<w2:column id="day15" name="15일" dataType="number" />
						<w2:column id="day16" name="16일" dataType="number" />
						<w2:column id="day17" name="17일" dataType="number" />
						<w2:column id="day18" name="18일" dataType="number" />
						<w2:column id="day19" name="19일" dataType="number" />
						<w2:column id="day20" name="20일" dataType="number" />
						<w2:column id="day21" name="21일" dataType="number" />
						<w2:column id="day22" name="22일" dataType="number" />
						<w2:column id="day23" name="23일" dataType="number" />
						<w2:column id="day24" name="24일" dataType="number" />
						<w2:column id="day25" name="25일" dataType="number" />
						<w2:column id="day26" name="26일" dataType="number" />
						<w2:column id="day27" name="27일" dataType="number" />
						<w2:column id="day28" name="28일" dataType="number" />
						<w2:column id="day29" name="29일" dataType="number" />
						<w2:column id="day30" name="30일" dataType="number" />
						<w2:column id="day31" name="31일" dataType="number" />
					</w2:columnInfo>
					<w2:data use="true">
						<w2:row>
							<shiftType>D</shiftType>
							<shiftLabel>D</shiftLabel>
						</w2:row>
						<w2:row>
							<shiftType>E</shiftType>
							<shiftLabel>E</shiftLabel>
						</w2:row>
						<w2:row>
							<shiftType>N</shiftType>
							<shiftLabel>N</shiftLabel>
						</w2:row>
					</w2:data>
				</w2:dataList>

				<!-- 화면 제어 데이터 -->
				<w2:dataMap baseNode="map" id="dm_control">
					<w2:keyInfo>
						<w2:key id="currentYear" name="현재년도" dataType="number" />
						<w2:key id="currentMonth" name="현재월" dataType="number" />
						<w2:key id="isGenerating" name="생성중여부" dataType="boolean" />
						<w2:key id="generationProgress" name="생성진행률" dataType="number" />
						<w2:key id="pivotMode" name="피벗모드" dataType="text" />
						<w2:key id="daysInMonth" name="월일수" dataType="number" />
						<w2:key id="offDays" name="기본휴무일" dataType="number" />
						<w2:key id="dutyCounts" name="듀티근무자수" dataType="number" />
						<w2:key id="maxWorkDays" name="최대연속근무일" dataType="number" />
						<w2:key id="maxNightDays" name="최대연속야간근무" dataType="number" />
						<w2:key id="buttonMode" name="버튼모드" dataType="text" />
					</w2:keyInfo>
					<w2:data>
						<currentYear>2025</currentYear>
						<currentMonth>7</currentMonth>
						<isGenerating>false</isGenerating>
						<generationProgress>0</generationProgress>
						<pivotMode>nurseByDay</pivotMode>
						<daysInMonth>31</daysInMonth>
						<offDays>10</offDays>
						<maxWorkDays>4</maxWorkDays>
						<maxNightDays>3</maxNightDays>
						<buttonMode>generate</buttonMode>
					</w2:data>
				</w2:dataMap>

				<!-- 요청용 데이터맵 - dataCollection 안으로 이동 -->
				<w2:dataMap baseNode="map" id="dma_sample">
					<w2:keyInfo>
						<w2:key dataType="number" name="간호사수" id="maxNurses"></w2:key>
						<w2:key dataType="date" name="시작일" id="startDate"></w2:key>
						<w2:key dataType="date" name="종료일" id="endDate"></w2:key>
						<w2:key dataType="" name="간호사정보" id="nurseList"></w2:key>
					</w2:keyInfo>
				</w2:dataMap>

				<!-- 응답용 데이터리스트 - dataCollection 안으로 이동 -->
				<w2:dataList baseNode="list" id="dlt_sample" repeatNode="map">
					<w2:columnInfo>
						<w2:column id="schId" name="스케줄ID" dataType="number" />
						<w2:column id="shiftDate" name="근무일" dataType="text" />
						<w2:column id="nurseId" name="간호사ID" dataType="number" />
						<w2:column id="shiftType" name="근무타입" dataType="text" />
					</w2:columnInfo>
				</w2:dataList>

			</w2:dataCollection>
			<xf:submission id="sbm_generateSchedule" action="http://localhost:8090/api/schedule/generate" method="post"
				mediatype="application/json" ref="data:json,dma_sample" target="data:json,dlt_sample" encoding="UTF-8" instance="" replace=""
				errorHandler="" customHandler="" mode="asynchronous" processMsg="" ev:submit="" ev:submitdone="scwin.sbm_generateSchedule_submitdone"
				ev:submiterror="scwin.sbm_generateSchedule_submiterror" abortTrigger="">
			</xf:submission>
		</xf:model>
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
		<script lazy="false" type="text/javascript"><![CDATA[
// 페이지 로드
scwin.onpageload = function () {
    scwin.isUpdating = false;
    scwin.initializePage();
    scwin.setCurrentMonth();

    setTimeout(function () {
        scwin.initializePivotData();
        scwin.initializeSummaryData();
        scwin.refreshGrids();
        scwin.updateColumnVisibility();
        scwin.initializeTooltip();

        scwin.initializeToggles();

        scwin.removeGridEffects();
    }, 500);

    setTimeout(function () {
        scwin.removeGridEffects();
    }, 2000);
};

// JavaScript에서 그리드뷰 속성 수정
scwin.removeGridEffects = function () {
    try {
        // 피벗 그리드뷰 효과 제거
        if (gv_pivotSchedule) {
            // 마우스 오버 색상 제거
            if (typeof gv_pivotSchedule.setRowMouseOverColor === 'function') {
                gv_pivotSchedule.setRowMouseOverColor('transparent');
            }

            // 선택된 셀 색상 제거
            if (typeof gv_pivotSchedule.setSelectedCellColor === 'function') {
                gv_pivotSchedule.setSelectedCellColor('transparent');
            }

            // 선택된 행 색상 제거
            if (typeof gv_pivotSchedule.setSelectedRowColor === 'function') {
                gv_pivotSchedule.setSelectedRowColor('transparent');
            }

            // 선택된 행 오버 색상 제거
            if (typeof gv_pivotSchedule.setSelectedRowOverColor === 'function') {
                gv_pivotSchedule.setSelectedRowOverColor('transparent');
            }
        }

        // 요약 그리드뷰 효과 제거
        if (gv_summarySchedule) {
            // 마우스 오버 색상 제거
            if (typeof gv_summarySchedule.setRowMouseOverColor === 'function') {
                gv_summarySchedule.setRowMouseOverColor('transparent');
            }

            // 선택된 셀 색상 제거
            if (typeof gv_summarySchedule.setSelectedCellColor === 'function') {
                gv_summarySchedule.setSelectedCellColor('transparent');
            }

            // 선택된 행 색상 제거
            if (typeof gv_summarySchedule.setSelectedRowColor === 'function') {
                gv_summarySchedule.setSelectedRowColor('transparent');
            }

            // 선택된 행 오버 색상 제거
            if (typeof gv_summarySchedule.setSelectedRowOverColor === 'function') {
                gv_summarySchedule.setSelectedRowOverColor('transparent');
            }
        }

    } catch (e) {
        console.error("그리드 효과 제거 중 오류:", e);
    }
};

// ===== 제약 조건 검사 및 셀 스타일 함수 =====

// 셀 스타일 함수 (그리드뷰에서 자동 호출)
scwin.pivotCellStyleFunction = function (rowIndex, colIndex, colID, value) {
    // 간호사명 컬럼은 스타일 적용 안함
    if (colID === "nurseName" || colID === "nurseId" || !colID.startsWith("day")) {
        return null;
    }

    // 제약 조건 검사
    var violations = scwin.checkConstraintViolations(rowIndex, colID, value);

    if (violations.length > 0) {
        // 심각한 위반 (연속 근무 초과)
        if (violations.some(v => v.type === "error")) {
            return {
                backgroundColor: "#ffebee",
                border: "2px solid #f44336",
                color: "#c62828",
                fontWeight: "bold"
            };
        }
        // 경고 (패턴 위반)
        else {
            return {
                backgroundColor: "#fff3e0",
                border: "2px solid #ff9800",
                color: "#ef6c00",
                fontWeight: "bold"
            };
        }
    }

    return null;
};

// 제약 조건 검사 함수
scwin.checkConstraintViolations = function (rowIndex, colID, currentValue) {
    var violations = [];
    var maxWorkDays = dm_control.get("maxWorkDays") || 4;
    var maxNightDays = dm_control.get("maxNightDays") || 3;
    var currentDay = parseInt(colID.replace("day", ""));

    // 1. 연속 근무일 체크
    var workStreak = scwin.getWorkStreak(rowIndex, currentDay, currentValue);
    if (workStreak > maxWorkDays) {
        violations.push({
            type: "error",
            message: `연속 근무 ${workStreak}일 (최대 ${maxWorkDays}일)`
        });
    }

    // 2. 연속 야간 근무 체크
    if (currentValue === "N") {
        var nightStreak = scwin.getNightStreak(rowIndex, currentDay, currentValue);
        if (nightStreak > maxNightDays) {
            violations.push({
                type: "error",
                message: `연속 야간 ${nightStreak}일 (최대 ${maxNightDays}일)`
            });
        }
    }

    // 3. 금지 패턴 체크
    var forbiddenPattern = scwin.checkForbiddenPatterns(rowIndex, currentDay, currentValue);
    if (forbiddenPattern) {
        violations.push({
            type: "warning",
            message: `금지 패턴: ${forbiddenPattern}`
        });
    }

    return violations;
};

// 연속 근무일 계산
scwin.getWorkStreak = function (rowIndex, currentDay, currentValue) {
    var streak = 0;
    var daysInMonth = dm_control.get("daysInMonth");

    // 현재 값이 근무가 아니면 0 반환
    if (currentValue === "X" || !currentValue) return 0;

    // 현재일부터 역순으로 연속 근무 계산
    for (var day = currentDay; day >= 1; day--) {
        var value = day === currentDay ? currentValue : dl_pivotData.getCellData(rowIndex, "day" + day);
        if (value === "D" || value === "E" || value === "N") {
            streak++;
        } else {
            break;
        }
    }

    // 현재일 이후 순차적으로 연속 근무 계산
    for (var day = currentDay + 1; day <= daysInMonth; day++) {
        var value = dl_pivotData.getCellData(rowIndex, "day" + day);
        if (value === "D" || value === "E" || value === "N") {
            streak++;
        } else {
            break;
        }
    }

    return streak;
};

// 연속 야간 근무 계산
scwin.getNightStreak = function (rowIndex, currentDay, currentValue) {
    var streak = 0;
    var daysInMonth = dm_control.get("daysInMonth");

    // 현재일부터 역순으로 연속 야간 계산
    for (var day = currentDay; day >= 1; day--) {
        var value = day === currentDay ? currentValue : dl_pivotData.getCellData(rowIndex, "day" + day);
        if (value === "N") {
            streak++;
        } else {
            break;
        }
    }

    // 현재일 이후 순차적으로 연속 야간 계산  
    for (var day = currentDay + 1; day <= daysInMonth; day++) {
        var value = dl_pivotData.getCellData(rowIndex, "day" + day);
        if (value === "N") {
            streak++;
        } else {
            break;
        }
    }

    return streak;
};

// 금지 패턴 체크
scwin.checkForbiddenPatterns = function (rowIndex, currentDay, currentValue) {
    // 3일 연속 패턴 체크 (DEN, NED, etc.)
    for (var startDay = Math.max(1, currentDay - 2); startDay <= Math.min(currentDay, dm_control.get("daysInMonth") - 2); startDay++) {
        var pattern = "";
        for (var i = 0; i < 3; i++) {
            var day = startDay + i;
            var value = day === currentDay ? currentValue : dl_pivotData.getCellData(rowIndex, "day" + day);
            pattern += value || "";
        }

        // 금지 패턴 목록
        var forbidden = ["DEN", "NED", "END", "DNE", "EDN", "NDE"];
        if (forbidden.includes(pattern)) {
            return pattern;
        }
    }

    // 2일 연속 패턴 체크 (NE, EN)
    for (var startDay = Math.max(1, currentDay - 1); startDay <= Math.min(currentDay, dm_control.get("daysInMonth") - 1); startDay++) {
        var pattern = "";
        for (var i = 0; i < 2; i++) {
            var day = startDay + i;
            var value = day === currentDay ? currentValue : dl_pivotData.getCellData(rowIndex, "day" + day);
            pattern += value || "";
        }

        if (pattern === "NE" || pattern === "EN") {
            return pattern;
        }
    }

    return null;
};

// 간소화된 refreshGridStyles 함수
scwin.refreshGridStyles = function () {
    // 그리드 새로고침
    if (gv_pivotSchedule && typeof gv_pivotSchedule.refresh === 'function') {
        gv_pivotSchedule.refresh();
    }

    // 제약 조건 스타일 적용 (툴팁 이벤트는 별도로)
    setTimeout(function () {
        scwin.applyConstraintStylesOnly();

        // 툴팁 이벤트는 더 늦게 추가 (그리드 완전히 렌더링 후)
        setTimeout(function () {
            scwin.addTooltipEvents();
        }, 1000);
    }, 300);
};

// 툴팁 엘리먼트 생성 및 초기화
scwin.initializeTooltip = function () {
    // 기존 툴팁이 있으면 제거
    var existingTooltip = document.getElementById('constraint-tooltip');
    if (existingTooltip) {
        existingTooltip.remove();
    }

    // 새 툴팁 엘리먼트 생성
    var tooltip = document.createElement('div');
    tooltip.id = 'constraint-tooltip';
    tooltip.className = 'constraint-tooltip';

    // 초기 스타일 직접 설정 (CSS가 적용 안 될 경우 대비)
    tooltip.style.position = 'fixed';
    tooltip.style.background = 'linear-gradient(135deg, #333, #555)';
    tooltip.style.color = 'white';
    tooltip.style.padding = '12px 16px';
    tooltip.style.borderRadius = '8px';
    tooltip.style.fontSize = '13px';
    tooltip.style.fontWeight = '500';
    tooltip.style.zIndex = '10000';
    tooltip.style.maxWidth = '300px';
    tooltip.style.wordWrap = 'break-word';
    tooltip.style.boxShadow = '0 4px 12px rgba(0,0,0,0.4)';
    tooltip.style.pointerEvents = 'none';
    tooltip.style.opacity = '0';
    tooltip.style.transform = 'translateY(10px)';
    tooltip.style.transition = 'all 0.3s ease';
    tooltip.style.border = '1px solid rgba(255,255,255,0.2)';

    document.body.appendChild(tooltip);

    return tooltip;
};

// 툴팁 표시 함수
scwin.showTooltip = function (event, message) {
    var tooltip = document.getElementById('constraint-tooltip');
    if (!tooltip) {
        tooltip = scwin.initializeTooltip();
    }

    if (!tooltip) {
        console.error("툴팁 생성 실패!");
        return;
    }

    tooltip.innerHTML = message;
    tooltip.style.opacity = '1';
    tooltip.style.transform = 'translateY(0px)';
    tooltip.style.display = 'block'; // 명시적으로 표시

    // 마우스 위치에 따라 툴팁 위치 조정
    var x = event.clientX || event.pageX || 0;
    var y = event.clientY || event.pageY || 0;

    // 안전한 위치 계산
    var windowWidth = window.innerWidth || document.documentElement.clientWidth;
    var windowHeight = window.innerHeight || document.documentElement.clientHeight;

    // 툴팁이 화면을 벗어나지 않도록 조정
    if (x + 300 > windowWidth) {
        x = windowWidth - 320;
    }
    if (y + 100 > windowHeight) {
        y = y - 120;
    } else {
        y = y + 20;
    }

    tooltip.style.left = Math.max(10, x) + 'px';
    tooltip.style.top = Math.max(10, y) + 'px';
};

// 툴팁 숨김 함수
scwin.hideTooltip = function () {
    var tooltip = document.getElementById('constraint-tooltip');
    if (tooltip) {
        tooltip.style.opacity = '0';
        tooltip.style.transform = 'translateY(10px)';
    } else {
        console.log("숨길 툴팁이 없음");
    }
};

scwin.injectTooltipStyles = function () {
    var existingStyle = document.getElementById('constraint-tooltip-styles');
    if (existingStyle) {
        existingStyle.remove();
    }

    var style = document.createElement('style');
    style.id = 'constraint-tooltip-styles';
    style.textContent = `
        .constraint-tooltip {
            position: fixed !important;
            background: linear-gradient(135deg, #333, #555) !important;
            color: white !important;
            padding: 12px 16px !important;
            border-radius: 8px !important;
            font-size: 13px !important;
            font-weight: 500 !important;
            z-index: 10000 !important;
            max-width: 300px !important;
            word-wrap: break-word !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.4) !important;
            pointer-events: none !important;
            opacity: 0 !important;
            transform: translateY(10px) !important;
            transition: all 0.3s ease !important;
            border: 1px solid rgba(255,255,255,0.2) !important;
        }
    `;

    document.head.appendChild(style);
};

// 그리드 셀에 툴팁 이벤트 리스너 추가
scwin.addTooltipEvents = function () {
    // 여러 시도로 그리드 요소 찾기
    var attemptCount = 0;
    var maxAttempts = 10;

    function tryAddTooltips() {
        attemptCount++;
        // 다양한 방법으로 그리드 요소 찾기
        var gridElement = document.getElementById('gv_pivotSchedule') ||
            document.getElementById('mf_wfr_mainContent_gv_pivotSchedule') ||
            document.querySelector('[id*="gv_pivotSchedule"]') ||
            document.querySelector('.w2gridview') ||
            document.querySelector('table');

        if (!gridElement) {
            if (attemptCount < maxAttempts) {
                setTimeout(tryAddTooltips, 500); // 0.5초 후 재시도
                return;
            } else {
                console.error("최대 시도 횟수 초과 - 그리드 요소를 찾을 수 없습니다");
                return;
            }
        }

        // tbody 찾기
        var tbody = gridElement.querySelector('tbody');
        if (!tbody) {
            var rows = gridElement.querySelectorAll('tr');
            if (rows.length === 0) {
                console.error("테이블 행을 찾을 수 없습니다");
                return;
            }
            // 첫 번째 행이 헤더일 가능성이 높으므로 제외
            rows = Array.from(rows).slice(1);
        } else {
            var rows = tbody.querySelectorAll('tr');
        }

        if (rows.length === 0) {
            console.error("데이터 행을 찾을 수 없습니다");
            return;
        }

        var daysInMonth = dm_control.get("daysInMonth");
        var tooltipCount = 0;

        for (var rowIdx = 0; rowIdx < Math.min(rows.length, dl_pivotData.getRowCount()); rowIdx++) {
            var row = rows[rowIdx];
            var cells = row.querySelectorAll('td');

            if (cells.length === 0) continue;

            for (var day = 1; day <= daysInMonth; day++) {
                // 웹스퀘어 그리드에서 첫 번째 컬럼은 간호사명이므로 day 컬럼은 1부터 시작
                var colIndex = day;

                if (colIndex < cells.length) {
                    var cell = cells[colIndex];
                    var colID = "day" + day;
                    var value = dl_pivotData.getCellData(rowIdx, colID);

                    if (!value || value === "X" || value === "") continue;

                    var violations = scwin.checkConstraintViolations(rowIdx, colID, value);

                    if (violations.length > 0) {
                        // 툴팁 메시지 생성
                        var nurseName = dl_pivotData.getCellData(rowIdx, "nurseName");
                        var messages = [];

                        messages.push(`<strong>${nurseName}</strong> - ${day}일 ${value}근무`);
                        messages.push(''); // 빈 줄

                        violations.forEach(function (violation) {
                            var icon = violation.type === 'error' ? '❌' : '⚠️';
                            messages.push(`${icon} ${violation.message}`);
                        });

                        var tooltipMessage = messages.join('<br>');

                        // 기존 이벤트 리스너 제거 (중복 방지)
                        cell.removeEventListener('mouseenter', cell._tooltipEnterHandler);
                        cell.removeEventListener('mousemove', cell._tooltipMoveHandler);
                        cell.removeEventListener('mouseleave', cell._tooltipLeaveHandler);

                        // 새 이벤트 리스너 추가 (클로저 사용)
                        (function (cellElement, message) {
                            cellElement._tooltipEnterHandler = function (e) {
                                scwin.showTooltip(e, message);
                            };

                            cellElement._tooltipMoveHandler = function (e) {
                                scwin.showTooltip(e, message);
                            };

                            cellElement._tooltipLeaveHandler = function () {
                                scwin.hideTooltip();
                            };

                            cellElement.addEventListener('mouseenter', cellElement._tooltipEnterHandler);
                            cellElement.addEventListener('mousemove', cellElement._tooltipMoveHandler);
                            cellElement.addEventListener('mouseleave', cellElement._tooltipLeaveHandler);

                            // 셀 스타일 추가 (호버 효과)
                            cellElement.style.cursor = 'help';

                        })(cell, tooltipMessage);

                        tooltipCount++;
                    }
                }
            }
        }
    }

    // 첫 번째 시도는 바로 실행
    tryAddTooltips();
};

scwin.applyConstraintStylesOnly = function () {
    var daysInMonth = dm_control.get("daysInMonth");

    // 1. 모든 셀 배경색 초기화
    for (var row = 0; row < dl_pivotData.getRowCount(); row++) {
        for (var day = 1; day <= daysInMonth; day++) {
            var colID = "day" + day;
            try {
                gv_pivotSchedule.setCellBackgroundColor(row, colID, "");
            } catch (e) {
                // 에러 무시하고 계속
            }
        }
    }

    // 2. 제약 위반 셀에 색상 적용
    var violationCount = 0;
    for (var row = 0; row < dl_pivotData.getRowCount(); row++) {
        for (var day = 1; day <= daysInMonth; day++) {
            var colID = "day" + day;
            var value = dl_pivotData.getCellData(row, colID);

            // 빈 값이나 휴무는 건너뛰기
            if (!value || value === "X" || value === "") continue;

            // 제약 조건 검사
            var violations = scwin.checkConstraintViolations(row, colID, value);

            if (violations.length > 0) {
                violationCount++;
                try {
                    // 심각한 위반 (연속 근무/야간 초과) - 빨간색
                    if (violations.some(v => v.type === "error")) {
                        gv_pivotSchedule.setCellBackgroundColor(row, colID, "#ffebee");
                    }
                    // 경고 (패턴 위반) - 주황색
                    else {
                        gv_pivotSchedule.setCellBackgroundColor(row, colID, "#fff3e0");
                    }
                } catch (e) {
                    console.error(`배경색 설정 실패: row=${row}, col=${colID}`, e);
                }
            }
        }
    }

    return violationCount;
};

// 입력값 검증 및 변환 함수
scwin.validateAndConvertShiftInput = function (inputValue) {
    if (!inputValue || inputValue.trim() === "") {
        return "";
    }

    // 대소문자 구분 없이 변환
    var normalized = inputValue.toString().toUpperCase().trim();

    // 유효한 값들
    var validValues = ["D", "E", "N", "X"];

    if (validValues.includes(normalized)) {
        return normalized;
    }

    // 잘못된 입력값 처리
    return null;
};

// 입력값 실시간 검증 (키 입력 시)
scwin.validateShiftKeyInput = function (event, rowIndex, colID) {
    var key = event.key.toUpperCase();
    var validKeys = ["D", "E", "N", "X", "BACKSPACE", "DELETE", "TAB", "ENTER"];

    // 유효하지 않은 키는 입력 차단
    if (!validKeys.includes(key) && key.length === 1) {
        event.preventDefault();
        return false;
    }

    return true;
};

// 데이터 변경 이벤트 개선
scwin.dl_pivotData_oncelldatachange = function (row, col, newValue, oldValue) {
    // 매개변수 정규화
    var rowIndex, colID, actualNewValue, actualOldValue;

    if (typeof row === 'object' && row !== null) {
        rowIndex = row.rowIndex;
        colID = row.colID;
        actualNewValue = row.newValue;
        actualOldValue = row.oldValue;
    } else {
        rowIndex = row;
        colID = col;
        actualNewValue = newValue;
        actualOldValue = oldValue;
    }

    // 컬럼 ID 확인
    if (!colID && typeof col === 'number') {
        var columnInfo = dl_pivotData.getColumnInfo();
        if (columnInfo && columnInfo[col]) {
            colID = columnInfo[col].id;
        }
    }

    // 기본 컬럼이나 day 컬럼이 아니면 리턴
    if (colID === "nurseName" || colID === "nurseId" || !colID || !colID.startsWith("day")) {
        return;
    }

    // 업데이트 중이면 리턴
    if (scwin.isUpdating) return;

    // 입력값 검증 및 변환
    var validatedValue = scwin.validateAndConvertShiftInput(actualNewValue);

    if (validatedValue === null && actualNewValue && actualNewValue.trim() !== "") {
        // 잘못된 입력값인 경우
        Swal.fire({
            icon: 'warning',
            title: '입력 오류',
            html: '올바른 근무 타입을 입력하세요.<br>D(주간), E(저녁), N(야간), X(휴무)',
            confirmButtonText: '확인',
            confirmButtonColor: '#1C3D6B'
        });

        // 이전 값으로 되돌리기
        setTimeout(function () {
            dl_pivotData.setCellData(rowIndex, colID, actualOldValue || "");
        }, 10);
        return;
    }

    // 빈 값이 아니고 변환된 값이 입력값과 다르면 자동 변환
    if (validatedValue && validatedValue !== actualNewValue) {
        setTimeout(function () {
            dl_pivotData.setCellData(rowIndex, colID, validatedValue);
        }, 10);
        actualNewValue = validatedValue;
    }

    scwin.isUpdating = true;

    setTimeout(function () {
        try {
            scwin.updateSummaryFromPivot();
            scwin.refreshGridStyles();
        } catch (e) {
            console.error("업데이트 중 오류:", e);
        } finally {
            scwin.isUpdating = false;
        }
    }, 100);
};

// ===== 설정 모달 관리 =====

scwin.editSettings = function () {
    if (div_settingsModal) {
        div_settingsModal.addClass("active");
    }
};

scwin.closeSettingsModal = function () {
    if (div_settingsModal) {
        div_settingsModal.removeClass("active");
    }
};

// 야간 근무 후 오프 토글 함수
scwin.toggleNightOff = function () {
    // DOM 요소 찾기 - 여러 방법으로 시도
    var element = document.getElementById('toggle_nightOff');

    if (!element) {
        // ID로 찾을 수 없으면 다른 방법으로 시도
        var toggleElements = document.querySelectorAll('[id*="toggle_nightOff"]');
        if (toggleElements.length > 0) {
            element = toggleElements[0];
        }
    }

    if (element) {
        // active 클래스 토글
        if (element.classList.contains("active")) {
            element.classList.remove("active");
        } else {
            element.classList.add("active");
        }
    } else {
        // 모든 토글 요소 찾아보기
        var allToggles = document.querySelectorAll('.toggle-switch');

        // 첫 번째 토글을 야간 오프 토글로 가정
        if (allToggles.length > 0) {
            element = allToggles[0];
            if (element.classList.contains("active")) {
                element.classList.remove("active");
            } else {
                element.classList.add("active");
            }
        }
    }
};

// 패턴 제한 토글 함수  
scwin.togglePatterns = function () {
    // DOM 요소 찾기
    var element = document.getElementById('toggle_patterns');

    if (!element) {
        var toggleElements = document.querySelectorAll('[id*="toggle_patterns"]');
        if (toggleElements.length > 0) {
            element = toggleElements[0];
        }
    }

    if (element) {
        // active 클래스 토글
        if (element.classList.contains("active")) {
            element.classList.remove("active");
        } else {
            element.classList.add("active");
        }
    } else {
        // 모든 토글 요소 찾아보기
        var allToggles = document.querySelectorAll('.toggle-switch');

        // 두 번째 토글을 패턴 토글로 가정
        if (allToggles.length > 1) {
            element = allToggles[1];
            if (element.classList.contains("active")) {
                element.classList.remove("active");
            } else {
                element.classList.add("active");
            }
        }
    }
};

// 설정 저장 함수도 수정 (토글 상태 읽기 개선)
scwin.saveSettings = function () {
    var maxWorkDays = inp_maxWorkDays.getValue();
    var maxNightDays = inp_maxNightDays.getValue();

    // 토글 상태 읽기 - 개선된 방법
    var nightOffElement = document.getElementById('toggle_nightOff');
    var patternsElement = document.getElementById('toggle_patterns');

    // ID로 찾을 수 없으면 클래스로 찾기
    if (!nightOffElement) {
        var toggles = document.querySelectorAll('.toggle-switch');
        nightOffElement = toggles[0];
        patternsElement = toggles[1];
    }

    var nightOffEnabled = nightOffElement ? nightOffElement.classList.contains("active") : false;
    var patternsEnabled = patternsElement ? patternsElement.classList.contains("active") : false;

    dm_control.set("maxWorkDays", parseInt(maxWorkDays));
    dm_control.set("maxNightDays", parseInt(maxNightDays));

    Swal.fire({
        icon: 'success',
        title: '저장 완료',
        text: '설정이 저장되었습니다!',
        confirmButtonText: '확인',
        confirmButtonColor: '#1C3D6B'
    });
    scwin.closeSettingsModal();
};

// 페이지 로드 시 토글 초기화 함수 추가
scwin.initializeToggles = function () {
    // 모든 토글 요소 찾기
    var toggles = document.querySelectorAll('.toggle-switch');

    // 각 토글에 클릭 이벤트 추가 (백업용)
    toggles.forEach(function (toggle, index) {
        // 기본 active 상태 설정
        if (!toggle.classList.contains("active")) {
            toggle.classList.add("active");
        }

        // 직접 이벤트 리스너 추가 (백업용)
        toggle.addEventListener('click', function () {
            if (toggle.classList.contains("active")) {
                toggle.classList.remove("active");
            } else {
                toggle.classList.add("active");
            }
        });
    });
};

// ===== 기존 시스템 함수들 =====

scwin.updateSummaryFromPivot = function () {
    var daysInMonth = dm_control.get("daysInMonth");

    for (var i = 0; i < dl_summaryData.getRowCount(); i++) {
        for (var day = 1; day <= daysInMonth; day++) {
            dl_summaryData.setCellData(i, "day" + day, 0);
        }
    }

    for (var day = 1; day <= daysInMonth; day++) {
        var columnName = "day" + day;
        var dCount = 0, eCount = 0, nCount = 0;

        for (var i = 0; i < dl_pivotData.getRowCount(); i++) {
            var shiftType = dl_pivotData.getCellData(i, columnName);
            if (shiftType === "D") dCount++;
            else if (shiftType === "E") eCount++;
            else if (shiftType === "N") nCount++;
        }

        dl_summaryData.setCellData(0, columnName, dCount);
        dl_summaryData.setCellData(1, columnName, eCount);
        dl_summaryData.setCellData(2, columnName, nCount);
    }

    if (gv_summarySchedule && typeof gv_summarySchedule.refresh === 'function') {
        gv_summarySchedule.refresh();
    }
};

scwin.initializePage = function () {
    var today = new Date();
    dm_control.set("currentYear", today.getFullYear());
    dm_control.set("currentMonth", today.getMonth() + 2);
    dm_control.set("isGenerating", false);
    dm_control.set("generationProgress", 0);
    dm_control.set("dutyCounts", 5);
    dm_control.set("maxWorkDays", 4);
    dm_control.set("maxNightDays", 3);
    dm_control.set("buttonMode", "generate");
};

scwin.setCurrentMonth = function () {
    var year = dm_control.get("currentYear");
    var month = dm_control.get("currentMonth");
    var daysInMonth = new Date(year, month, 0).getDate();

    dm_control.set("daysInMonth", daysInMonth);

    if (out_monthDisplay) {
        out_monthDisplay.setValue(year + "년 " + month + "월");
    }

    setTimeout(function () {
        scwin.updateColumnVisibility();
    }, 100);
};

scwin.changeMonth = function (direction) {
    var currentYear = dm_control.get("currentYear");
    var currentMonth = dm_control.get("currentMonth");
    var newMonth = currentMonth + direction;
    var newYear = currentYear;

    if (newMonth < 1) {
        newMonth = 12;
        newYear--;
    } else if (newMonth > 12) {
        newMonth = 1;
        newYear++;
    }

    dm_control.set("currentYear", newYear);
    dm_control.set("currentMonth", newMonth);

    dm_control.set("buttonMode", "generate");

    scwin.setCurrentMonth();
    scwin.clearScheduleData();
};

scwin.initializePivotData = function () {
    scwin.isUpdating = true;
    dl_pivotData.removeAll();

    for (var i = 0; i < dl_nurseList.getRowCount(); i++) {
        var nurse = dl_nurseList.getRowJSON(i);
        var newRowIndex = dl_pivotData.insertRow(dl_pivotData.getRowCount());

        dl_pivotData.setCellData(newRowIndex, "nurseId", nurse.nurseId);
        dl_pivotData.setCellData(newRowIndex, "nurseName", nurse.nurseName);

        for (var day = 1; day <= 31; day++) {
            dl_pivotData.setCellData(newRowIndex, "day" + day, "");
        }
    }

    setTimeout(function () {
        scwin.isUpdating = false;
    }, 200);
};

scwin.initializeSummaryData = function () {
    for (var i = 0; i < dl_summaryData.getRowCount(); i++) {
        for (var day = 1; day <= 31; day++) {
            dl_summaryData.setCellData(i, "day" + day, 0);
        }
    }
};

scwin.refreshGrids = function () {
    if (scwin.isUpdating) return;

    if (gv_pivotSchedule && typeof gv_pivotSchedule.refresh === 'function') {
        gv_pivotSchedule.refresh();

        // 스크롤 완전 제거
        setTimeout(function () {
            try {
                // 그리드 스크롤 설정 비활성화
                gv_pivotSchedule.setScrollByRow(false);
                gv_pivotSchedule.setScrollByColumn(false);

                // DOM 요소에서도 스크롤 제거
                var gridElement = document.getElementById('gv_pivotSchedule');
                if (gridElement) {
                    var scrollElements = gridElement.querySelectorAll('[style*="overflow"]');
                    scrollElements.forEach(function (el) {
                        el.style.overflow = 'visible';
                        el.style.maxHeight = 'none';
                    });
                }
            } catch (e) {
                console.log("그리드 스크롤 설정 실패:", e);
            }
        }, 100);

        // 키보드 입력 이벤트 추가
        setTimeout(function () {
            scwin.addKeyboardValidation();
        }, 200);
    }

    if (gv_summarySchedule && typeof gv_summarySchedule.refresh === 'function') {
        gv_summarySchedule.refresh();
    }
};

// 키보드 입력 검증 이벤트 추가
scwin.addKeyboardValidation = function () {
    var gridElement = document.getElementById('gv_pivotSchedule');
    if (!gridElement) return;

    var inputs = gridElement.querySelectorAll('input[type="text"]');

    inputs.forEach(function (input) {
        // 기존 이벤트 제거
        input.removeEventListener('keydown', input._keydownHandler);
        input.removeEventListener('input', input._inputHandler);

        // 키다운 이벤트 (입력 제한)
        input._keydownHandler = function (event) {
            var key = event.key.toUpperCase();
            var allowedKeys = ['D', 'E', 'N', 'X', 'BACKSPACE', 'DELETE', 'TAB', 'ENTER', 'ESCAPE'];

            // 숫자나 특수문자 입력 차단
            if (key.length === 1 && !allowedKeys.includes(key)) {
                event.preventDefault();
                return false;
            }
        };

        // 입력 이벤트 (값 변환)
        input._inputHandler = function (event) {
            var value = event.target.value;
            if (value && value.length > 0) {
                var converted = value.toUpperCase().slice(-1); // 마지막 문자만
                if (['D', 'E', 'N', 'X'].includes(converted)) {
                    event.target.value = converted;
                }
            }
        };

        input.addEventListener('keydown', input._keydownHandler);
        input.addEventListener('input', input._inputHandler);
    });
};

scwin.clearScheduleData = function () {
    dl_scheduleData.removeAll();
    scwin.initializePivotData();
    scwin.initializeSummaryData();
    scwin.refreshGrids();
};

scwin.updateColumnVisibility = function () {
    var daysInMonth = dm_control.get("daysInMonth");

    if (gv_pivotSchedule && gv_pivotSchedule.setColumnVisible) {
        for (var day = 1; day <= 31; day++) {
            gv_pivotSchedule.setColumnVisible("day" + day, day <= daysInMonth);
        }
    }
    if (gv_summarySchedule && gv_summarySchedule.setColumnVisible) {
        for (var day = 1; day <= 31; day++) {
            gv_summarySchedule.setColumnVisible("day" + day, day <= daysInMonth);
        }
    }
};

scwin.generateSchedule = function () {
    if (dm_control.get("isGenerating")) {
        Swal.fire({
            icon: 'info',
            title: '진행 중',
            text: '이미 생성 중입니다.',
            confirmButtonText: '확인',
            confirmButtonColor: '#1C3D6B'
        });
        return;
    }

    dm_control.set("isGenerating", true);
    dm_control.set("generationProgress", 0);

    // 진행률 모달 표시
    if (div_progressModal) {
        div_progressModal.addClass("active");
    }

    scwin.startModalProgressSimulation();
    scwin.prepareApiRequestData();
    $p.executeSubmission("sbm_generateSchedule");
};

// 모달 진행률 시뮬레이션
scwin.startModalProgressSimulation = function () {
    var progressInterval = setInterval(function () {
        var currentProgress = dm_control.get("generationProgress");
        var newProgress = currentProgress + (100 / 60); // 60초로 조정

        if (newProgress >= 95) {
            newProgress = 95;
            clearInterval(progressInterval);
        }

        dm_control.set("generationProgress", newProgress);
        scwin.updateModalProgressBar(newProgress);
    }, 1000);

    dm_control.set("progressInterval", progressInterval);
};

// 모달 진행률 바 업데이트
scwin.updateModalProgressBar = function (progress) {
    var progressBar = document.getElementById("div_modalProgressBar");
    if (progressBar) {
        progressBar.style.width = progress + "%";
    }
    if (out_modalProgressText) {
        var progressTexts = [
            "간호사 데이터 분석 중...",
            "제약 조건 검사 중...",
            "최적 조합 계산 중...",
            "스케줄 검증 중...",
            "최종 조정 중..."
        ];
        var textIndex = Math.floor(progress / 20);
        var text = progressTexts[Math.min(textIndex, progressTexts.length - 1)];
        out_modalProgressText.setValue(text + " " + Math.round(progress) + "%");
    }
};

scwin.prepareApiRequestData = function () {
    var year = dm_control.get("currentYear");
    var month = dm_control.get("currentMonth");
    var daysInMonth = dm_control.get("daysInMonth");

    var startDate = year + "-" + (month < 10 ? "0" + month : month) + "-01";
    var endDate = year + "-" + (month < 10 ? "0" + month : month) + "-" + (daysInMonth < 10 ? "0" + daysInMonth : daysInMonth);

    var nurseList = [];
    for (var i = 0; i < dl_nurseList.getRowCount(); i++) {
        var nurse = dl_nurseList.getRowJSON(i);
        nurseList.push({
            "nurseId": parseInt(nurse.nurseId),
            "name": nurse.nurseName,
            "experience": parseInt(nurse.experience),
            "isNightKeep": parseInt(nurse.isNightKeep) === 1 ? 1 : 0,
            "requests": []
        });
    }

    dma_sample.set("maxNurses", dl_nurseList.getRowCount());
    dma_sample.set("startDate", startDate);
    dma_sample.set("endDate", endDate);
    dma_sample.set("nurseList", nurseList);
};

scwin.startProgressSimulation = function () {
    var progressInterval = setInterval(function () {
        var currentProgress = dm_control.get("generationProgress");
        var newProgress = currentProgress + (100 / 30);

        if (newProgress >= 90) {
            newProgress = 90;
            clearInterval(progressInterval);
        }

        dm_control.set("generationProgress", newProgress);
        scwin.updateProgressBar(newProgress);
    }, 1000);

    dm_control.set("progressInterval", progressInterval);
};

scwin.updateProgressBar = function (progress) {
    var progressBar = document.getElementById("div_progressBar");
    if (progressBar) {
        progressBar.style.width = progress + "%";
    }
    if (out_progressText) {
        out_progressText.setValue("생성 중... " + Math.round(progress) + "%");
    }
};

scwin.sbm_generateSchedule_submitdone = function (e) {
    scwin.updatePivotWithSchedule();
    scwin.updateSummaryWithSchedule();
    scwin.updateColumnVisibility();
    scwin.completeModalGeneration();
};

// 모달 생성 완료 처리
scwin.completeModalGeneration = function () {
    dm_control.set("isGenerating", false);
    dm_control.set("generationProgress", 100);
    scwin.updateModalProgressBar(100);

    var progressInterval = dm_control.get("progressInterval");
    if (progressInterval) {
        clearInterval(progressInterval);
    }

    // 진행률 컨텐츠 숨기고 성공 컨텐츠 표시
    setTimeout(function () {
        if (div_progressContent) {
            div_progressContent.hide();
        }
        if (div_guidelineSection) {
            div_guidelineSection.hide();
        }
        if (div_successContent) {
            div_successContent.show();
        }
        if (div_progressModalFooter) {
            div_progressModalFooter.show();
        }

        dm_control.set("buttonMode", "confirm");
    }, 1000);
};

// 진행률 모달 닫기
scwin.closeProgressModal = function () {
    if (div_progressModal) {
        div_progressModal.removeClass("active");
    }

    // 모달 상태 초기화 (하지만 버튼 상태는 유지)
    setTimeout(function () {
        if (div_progressContent) {
            div_progressContent.show();
        }
        if (div_guidelineSection) {
            div_guidelineSection.show();
        }
        if (div_successContent) {
            div_successContent.hide();
        }
        if (div_progressModalFooter) {
            div_progressModalFooter.hide();
        }

        // 진행률 초기화
        dm_control.set("generationProgress", 0);
        scwin.updateModalProgressBar(0);

    }, 300);
};

// 듀티 확정 함수
scwin.confirmDuty = function () {
    dm_control.set("isDutyConfirmed", true);
    Swal.fire({
        icon: 'success',
        title: '듀티 확정',
        text: '성공적으로 듀티가 확정되었습니다!',
        confirmButtonText: '확인',
        confirmButtonColor: '#1C3D6B'
    });
};

scwin.sbm_generateSchedule_submiterror = function (e) {
    scwin.handleModalGenerationError("API 요청 중 오류가 발생했습니다.");
};

scwin.handleModalGenerationError = function (message) {
    dm_control.set("isGenerating", false);
    dm_control.set("generationProgress", 0);

    var progressInterval = dm_control.get("progressInterval");
    if (progressInterval) {
        clearInterval(progressInterval);
    }

    if (div_progressModal) {
        div_progressModal.removeClass("active");
    }

    Swal.fire({
        icon: 'error',
        title: '오류',
        text: message,
        confirmButtonText: '확인',
        confirmButtonColor: '#1C3D6B'
    });
};

scwin.updatePivotWithSchedule = function () {
    var scheduleData = dlt_sample.getAllJSON();
    if (scheduleData.length === 0) return;

    var nurseScheduleMap = {};
    for (var i = 0; i < scheduleData.length; i++) {
        var schedule = scheduleData[i];
        var nurseId = schedule.nurseId;
        var dayColumn = scwin.convertDateToColumnName(schedule.shiftDate);
        var shiftType = scwin.convertShiftType(schedule.shiftType);

        if (!nurseScheduleMap[nurseId]) {
            nurseScheduleMap[nurseId] = {};
        }
        nurseScheduleMap[nurseId][dayColumn] = shiftType;
    }

    for (var i = 0; i < dl_pivotData.getRowCount(); i++) {
        for (var day = 1; day <= 31; day++) {
            dl_pivotData.setCellData(i, "day" + day, "");
        }
    }

    for (var nurseId in nurseScheduleMap) {
        var rowIndex = scwin.findNurseRowIndex(nurseId);
        if (rowIndex >= 0) {
            var scheduleMap = nurseScheduleMap[nurseId];
            for (var dayColumn in scheduleMap) {
                dl_pivotData.setCellData(rowIndex, dayColumn, scheduleMap[dayColumn]);
            }
        }
    }

    setTimeout(function () {
        scwin.refreshGridStyles();
    }, 200);
};

scwin.updateSummaryWithSchedule = function () {
    var year = dm_control.get("currentYear");
    var month = dm_control.get("currentMonth");

    scwin.initializeSummaryData();

    var scheduleData = dlt_sample.getAllJSON();
    for (var i = 0; i < scheduleData.length; i++) {
        var schedule = scheduleData[i];
        var scheduleDate = new Date(schedule.shiftDate);

        if (scheduleDate.getFullYear() === year && scheduleDate.getMonth() + 1 === month) {
            var day = scheduleDate.getDate();
            var shiftType = schedule.shiftType;

            for (var j = 0; j < dl_summaryData.getRowCount(); j++) {
                if (dl_summaryData.getCellData(j, "shiftType") === shiftType) {
                    var columnName = "day" + day;
                    var currentCount = dl_summaryData.getCellData(j, columnName) || 0;
                    dl_summaryData.setCellData(j, columnName, currentCount + 1);
                    break;
                }
            }
        }
    }
};

scwin.findNurseRowIndex = function (nurseId) {
    for (var i = 0; i < dl_pivotData.getRowCount(); i++) {
        if (dl_pivotData.getCellData(i, "nurseId") == nurseId) {
            return i;
        }
    }
    return -1;
};

scwin.convertDateToColumnName = function (dateString) {
    var dateParts = dateString.split("-");
    var day = parseInt(dateParts[2]);
    return "day" + day;
};

scwin.convertShiftType = function (serverShiftType) {
    var shiftTypeMap = {
        "D": "D",
        "E": "E",
        "N": "N",
        "Off": "X"
    };
    return shiftTypeMap[serverShiftType] || "X";
};]]></script>
	</head>
	<body ev:onpageload="scwin.onpageload" style="background-color: #f8f9fa;">
		<!-- 메인 컨테이너 -->
		<xf:group class="main-container">
			<!-- 상단 컨트롤 영역 -->
			<xf:group class="control-header">
				<xf:group class="control-row">
					<!-- 좌측 컨트롤 - 화살표 버튼 방식 -->
					<xf:group class="control-left">
						<xf:group class="month-control">
							<xf:trigger class="month-arrow" ev:onclick="scwin.changeMonth(-1)">
								<xf:label>◀</xf:label>
							</xf:trigger>
							<w2:output id="out_monthDisplay" class="month-display" value="2025년 8월" />
							<xf:trigger class="month-arrow" ev:onclick="scwin.changeMonth(1)">
								<xf:label>▶</xf:label>
							</xf:trigger>
						</xf:group>
					</xf:group>

					<!-- 우측 컨트롤 -->
					<xf:group class="control-right">
						<xf:trigger class="btn btn-settings" ev:onclick="scwin.editSettings">
							<xf:label>설정 편집</xf:label>
						</xf:trigger>
						<xf:trigger class="btn btn-generate" ev:onclick="scwin.generateSchedule">
							<xf:label>자동 생성</xf:label>
						</xf:trigger>
						<xf:trigger class="btn btn-settings" ev:onclick="scwin.confirmDuty">
							<xf:label>듀티 확정</xf:label>
						</xf:trigger>
					</xf:group>
				</xf:group>

				<div class="important-notice">
					⚠️ 자동 생성 후 스케줄 표에 생긴 오류를 직접 클릭하여 텍스트(대소문자 구분 없이 D: day, E: evening, N:night, X:off)로 수정할 수 있습니다!
				</div>

				<!-- 피벗 테이블 영역 -->
				<xf:group class="pivot-section">
					<xf:group class="section-content">
						<xf:group class="grid-container" style="height:1100px;">
							<!-- 피벗 그리드뷰 (31일 정적 컬럼) -->
							<w2:gridView id="gv_pivotSchedule" dataList="dl_pivotData" style="width:100%;height:1100px;" scrollByColumn="false"
								scrollByColumnAdaptive="false" useFilterList="false" useInputEnterKey="false" applyAllColumnStyle="true"
								cellStyleFunction="scwin.pivotCellStyleFunction" rowMouseOverColor="transparent" selectedCellColor="transparent"
								selectedRowColor="transparent" selectedRowOverColor="transparent" evenRowBackgroundColor="#f8f9fa" oddRowBackgroundColor="#f8f9fa"
								oddEvenColorDisplay="true" rowMouseOver="false" editModeEvent="onclick">
								<w2:header id="header1" style="height:70px;background-color:#1C3D6B;color:white;font-weight:bold;"
									applyAllColumnStyle="true" evenRowBackgroundColor="#f8f9fa" oddRowBackgroundColor="#f8f9fa" oddEvenColorDisplay="true"
									rowMouseOverColor="#e3f2fd" selectedCellColor="#bbdefb" selectedRowColor="#e3f2fd" selectedRowOverColor="#d1c4e9"
									rowNumBackgroundColor="#f5f5f5">
									<w2:row id="row1" style="height:35px;background-color:#1C3D6B;color:white;">
										<w2:column width="70" inputType="text" value=""
											style="background-color:#103E6B;color:white;font-weight:bold;border:none;">
										</w2:column>
										<w2:column width="45" inputType="text" value="1"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="2"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="3"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="4"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="5"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="6"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="7"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="8"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="9"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="10"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="11"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="12"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="13"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="14"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="15"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="16"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="17"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="18"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="19"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="20"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="21"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="22"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="23"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="24"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="25"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="26"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="27"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="28"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="29"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="30"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
										<w2:column width="45" inputType="text" value="31"
											style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;">
										</w2:column>
									</w2:row>
								</w2:header>
								<w2:gBody>
									<w2:row id="row2" style="height:35px">
										<!-- 간호사명 컬럼 - 스타일 직접 지정 -->
										<w2:column width="70" inputType="text" id="nurseName"
											style="background-color:#C3F4E6;font-weight:bold;text-align:center;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day1" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day2" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day3" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day4" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day5" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day6" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day7" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day8" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day9" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day10" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day11" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day12" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day13" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day14" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day15" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day16" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day17" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day18" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day19" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day20" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day21" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day22" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day23" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day24" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day25" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day26" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day27" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day28" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day29" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day30" style="text-align:center;font-weight:600;">
										</w2:column>

										<w2:column width="45" inputType="text" id="day31" style="text-align:center;font-weight:600;">
										</w2:column>
									</w2:row>
								</w2:gBody>
							</w2:gridView>

						</xf:group>
					</xf:group>
				</xf:group>
			</xf:group>

			<!-- 일별 소계 영역 -->
			<xf:group class="summary-section">
				<xf:group class="section-content">
					<w2:gridView scrollByColumnAdaptive="false" oddEvenColorDisplay="true" selectedRowColor="transparent"
						useInputEnterKey="false" scrollByColumn="false" readOnly="true" rowNumRowMouseOverColor="false" selectedRowOverColor="transparent"
						applyAllColumnStyle="true" selectedCellColor="transparent" rowMouseOver="false" dataList="dl_summaryData"
						evenRowBackgroundColor="#f8f9fa" oddRowBackgroundColor="#f8f9fa" style="width:100%;height:180px;margin:50px;" id="gv_summarySchedule"
						useFilterList="false" rowMouseOverColor="transparent">
						<w2:header applyAllColumnStyle="true" style="height:35px;background-color:#1C3D6B;color:white;font-weight:bold;"
							id="header2">
							<w2:row style="height:35px;background-color:#1C3D6B;color:white;" id="row3">
								<w2:column width="60" inputType="text" readOnly="true"
									style="background-color:#103E6B;color:white;font-weight:bold;border:none;text-align:center;" id="shiftLabel" value="">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day1" value="1">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day2" value="2">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day3" value="3">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day4" value="4">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day5" value="5">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day6" value="6">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day7" value="7">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day8" value="8">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day9" value="9">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day10" value="10">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day11" value="11">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day12" value="12">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day13" value="13">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day14" value="14">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day15" value="15">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day16" value="16">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day17" value="17">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day18" value="18">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day19" value="19">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day20" value="20">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day21" value="21">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day22" value="22">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day23" value="23">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day24" value="24">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day25" value="25">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day26" value="26">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day27" value="27">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day28" value="28">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day29" value="29">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day30" value="30">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true"
									style="background-color:#1C3D6B;color:white;font-weight:bold;text-align:center;" id="day31" value="31">
								</w2:column>
							</w2:row>
						</w2:header>
						<w2:gBody>
							<w2:row style="height:35px" id="row4">
								<w2:column width="60" inputType="text" readOnly="true"
									style="background-color:#C3F4E6;font-weight:bold;text-align:center;" id="shiftLabel">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day1">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day2">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day3">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day4">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day5">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day6">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day7">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day8">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day9">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day10">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day11">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day12">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day13">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day14">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day15">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day16">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day17">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day18">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day19">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day20">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day21">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day22">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day23">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day24">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day25">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day26">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day27">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day28">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day29">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day30">
								</w2:column>
								<w2:column width="45" inputType="text" readOnly="true" style="text-align:center;font-weight:600;" id="day31">
								</w2:column>
							</w2:row>
						</w2:gBody>
					</w2:gridView>
				</xf:group>
			</xf:group>
		</xf:group>
		<!-- 설정 편집 모달 -->
		<xf:group id="div_settingsModal" class="modal-overlay">
			<xf:group class="modal-container">
				<!-- 모달 헤더 -->
				<xf:group class="modal-header">
					<w2:textbox class="modal-title" label="스케줄 설정" />
					<xf:trigger class="modal-close" ev:onclick="scwin.closeSettingsModal">
						<xf:label>×</xf:label>
					</xf:trigger>
				</xf:group>

				<!-- 모달 바디 -->
				<xf:group class="modal-body">
					<!-- 기본 설정 섹션 -->
					<xf:group class="setting-section">
						<xf:group class="section-title">
							<w2:textbox label="기본 설정" />
						</xf:group>

						<xf:group class="setting-item">
							<xf:group>
								<w2:textbox class="setting-label" label="듀티 근무자 수" />
								<w2:textbox class="setting-description" label="듀티당 근무하는 근무자의 수" />
							</xf:group>
							<xf:group class="setting-control">
								<w2:input id="inp_dutyCounts" class="number-input" style="width:60px;" ref="data:dm_control.dutyCounts" />
								<w2:textbox label="명" />
							</xf:group>
						</xf:group>

						<xf:group class="setting-item">
							<xf:group>
								<w2:textbox class="setting-label" label="최대 연속 근무일" />
								<w2:textbox class="setting-description" label="연속으로 근무할 수 있는 최대 일수" />
							</xf:group>
							<xf:group class="setting-control">
								<w2:input id="inp_maxWorkDays" class="number-input" style="width:60px;" ref="data:dm_control.maxWorkDays" />
								<w2:textbox label="일" />
							</xf:group>
						</xf:group>

						<xf:group class="setting-item">
							<xf:group>
								<w2:textbox class="setting-label" label="최대 연속 야간 근무" />
								<w2:textbox class="setting-description" label="연속으로 야간 근무할 수 있는 최대 일수" />
							</xf:group>
							<xf:group class="setting-control">
								<w2:input id="inp_maxNightDays" class="number-input" style="width:60px;" ref="data:dm_control.maxNightDays" />
								<w2:textbox label="일" />
							</xf:group>
						</xf:group>
					</xf:group>

					<!-- 근무 타입 설정 섹션 -->
					<xf:group class="setting-section">
						<xf:group class="section-title">
							<w2:textbox label="근무 타입 설정" />
						</xf:group>

						<xf:group class="setting-item">
							<xf:group>
								<w2:textbox class="setting-label" label="야간 근무 후 오프 배정" />
								<w2:textbox class="setting-description" label="야간 근무 다음날 자동으로 휴무 배정" />
							</xf:group>
							<xf:group class="setting-control">
								<xf:group id="toggle_nightOff" class="toggle-switch active">

									<xf:group class="toggle-slider"></xf:group>
								</xf:group>
							</xf:group>
						</xf:group>

						<xf:group class="setting-item">
							<xf:group>
								<w2:textbox class="setting-label" label="ND / ED / NE / NOD 근무 패턴 불가능" />
								<w2:textbox class="setting-description" label="연속된 특정 근무 패턴 조합 제한" />
							</xf:group>
							<xf:group class="setting-control">
								<xf:group id="toggle_patterns" class="toggle-switch active">
									<xf:group class="toggle-slider"></xf:group>
								</xf:group>
							</xf:group>
						</xf:group>
					</xf:group>
				</xf:group>

				<!-- 모달 푸터 -->
				<xf:group class="modal-footer">
					<xf:trigger class="btn-modal-cancel" ev:onclick="scwin.closeSettingsModal">
						<xf:label>취소</xf:label>
					</xf:trigger>
					<xf:trigger class="btn-modal-save" ev:onclick="scwin.saveSettings">
						<xf:label>저장</xf:label>
					</xf:trigger>
				</xf:group>
			</xf:group>
		</xf:group>

		<!-- 진행률 모달 -->
		<xf:group id="div_progressModal" class="progress-modal-overlay">
			<xf:group class="progress-modal-container">
				<!-- 모달 헤더 -->
				<xf:group class="progress-modal-header">
					<w2:textbox class="progress-modal-title" label="AI 스케줄 생성 진행 중" />
					<w2:textbox class="progress-modal-subtitle" label="최적의 듀티 스케줄을 생성하고 있습니다" />
				</xf:group>

				<!-- 모달 바디 -->
				<xf:group class="progress-modal-body">
					<!-- 가이드라인 섹션 -->
					<xf:group id="div_guidelineSection" class="guideline-section">
						<xf:group class="guideline-title">
							<w2:textbox label="스마트 듀티 시스템 가이드라인" />
						</xf:group>

						<xf:group class="guideline-item">
							<xf:group class="guideline-item-icon">1</xf:group>
							<xf:group class="guideline-item-content">
								<w2:textbox class="guideline-item-title" label="AI 기반" />
								<w2:textbox class="guideline-item-desc" label="Hard/Soft 제약 스케줄링 알고리즘을 통해 각 간호사의 경력, 선호도, 근무 패턴을 분석하여 최적의 스케줄을 생성합니다." />
							</xf:group>
						</xf:group>

						<xf:group class="guideline-item">
							<xf:group class="guideline-item-icon">2</xf:group>
							<xf:group class="guideline-item-content">
								<w2:textbox class="guideline-item-title" label="공정한 업무 분배" />
								<w2:textbox class="guideline-item-desc" label="2019년에 제정된 간호사 근무 가이드라인에 맞춰 공정한 업무 분배를 수행합니다." />
							</xf:group>
						</xf:group>

						<xf:group class="guideline-item">
							<xf:group class="guideline-item-icon">3</xf:group>
							<xf:group class="guideline-item-content">
								<w2:textbox class="guideline-item-title" label="근무 규정 준수" />
								<w2:textbox class="guideline-item-desc"
									label="연속 근무일 제한, 야간 근무 후 휴무 보장 등 법적 규정과 병원 정책을 자동으로 적용합니다. 필요시 설정 편집을 통해 맞춤 설정을 진행할 수 있습니다." />
							</xf:group>
						</xf:group>

						<xf:group class="guideline-item">
							<xf:group class="guideline-item-icon">4</xf:group>
							<xf:group class="guideline-item-content">
								<w2:textbox class="guideline-item-title" label="실시간 조정 가능" />
								<w2:textbox class="guideline-item-desc" label="생성된 스케줄은 언제든지 수정 가능하며, 변경 시 자동으로 제약 조건을 검사합니다." />
							</xf:group>
						</xf:group>
					</xf:group>

					<!-- 진행률 섹션 -->
					<xf:group id="div_progressContent" class="modal-progress-container">
						<w2:output id="out_modalProgressText" class="modal-progress-text" value="분석 중... 0%" />
					</xf:group>

					<!-- 성공 컨텐츠 (처음엔 숨김) -->
					<xf:group id="div_successContent" class="success-content" style="display: none;">
						<xf:group class="success-icon">✓</xf:group>
						<w2:textbox class="success-title" label="스케줄 생성 완료!" />
						<w2:textbox class="success-message" label="AI가 모든 제약 조건을 고려하여 최적의 듀티 스케줄을 생성했습니다." />
					</xf:group>
				</xf:group>

				<!-- 모달 푸터 (성공 시에만 표시) -->
				<xf:group id="div_progressModalFooter" class="progress-modal-footer" style="display: none;">
					<xf:trigger class="btn-close-modal" ev:onclick="scwin.closeProgressModal">
						<xf:label>확인</xf:label>
					</xf:trigger>
				</xf:group>
			</xf:group>
		</xf:group>
	</body>
</html>