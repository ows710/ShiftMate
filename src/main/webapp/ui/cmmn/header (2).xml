<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:w2="http://www.inswave.com/websquare"
	xmlns:xf="http://www.w3.org/2002/xforms">
	<head meta_screenName="í—¤ë” í˜ì´ì§€">
		<w2:type>COMPONENT</w2:type>
		<w2:buildDate />
		<w2:MSA />
		<xf:model>
			<w2:dataCollection baseNode="map" />
			<w2:workflowCollection />
		</xf:model>
		<w2:layoutInfo />
		<w2:publicInfo method="" />
		<style type="text/css">
			.header-container {
				display: flex;
				justify-content: space-between;
				align-items: center;
				padding: 0 20px;
				background: white;
				color: #333;
				position: fixed;
				top: 0;
				left: 0;
				right: 0;
				z-index: 1001;
				height: 90px;
				box-shadow: 0 2px 4px rgba(0,0,0,0.1);
				border-bottom: 1px solid #e0e0e0;
			}
			
			.left-section {
				display: flex;
				align-items: center;
				width: 60px;
			}
			
			.hamburger-menu {
				width: 24px;
				height: 24px;
				cursor: pointer;
				display: flex;
				flex-direction: column;
				justify-content: space-between;
				padding: 4px 0;
				position: relative;
			}
			
			.hamburger-line {
				width: 24px;
				height: 2px;
				background: #333;
				border-radius: 1px;
				transition: all 0.3s ease;
				transform-origin: center;
			}
			
			/* ì´ˆê¸° ìƒíƒœ: ì‚¬ì´ë“œë°”ê°€ ì—´ë ¤ìˆìœ¼ë¯€ë¡œ X ëª¨ì–‘ìœ¼ë¡œ ì‹œì‘ */
			.hamburger-menu {
				/* ì´ˆê¸° collapsed ìƒíƒœ ì ìš© */
			}
			
			.hamburger-menu .hamburger-line:nth-child(1) {
				transform: rotate(45deg) translate(5px, 5px);
			}
			
			.hamburger-menu .hamburger-line:nth-child(2) {
				opacity: 0;
			}
			
			.hamburger-menu .hamburger-line:nth-child(3) {
				transform: rotate(-45deg) translate(7px, -6px);
			}
			
			/* í–„ë²„ê±° ì•„ì´ì½˜ í† ê¸€ ìƒíƒœ (ì‚¬ì´ë“œë°”ê°€ ë‹«í˜”ì„ ë•Œ ì¼ë°˜ í–„ë²„ê±°ë¡œ ë³µì›) */
			.hamburger-menu.collapsed .hamburger-line:nth-child(1) {
				transform: none;
			}
			
			.hamburger-menu.collapsed .hamburger-line:nth-child(2) {
				opacity: 1;
			}
			
			.hamburger-menu.collapsed .hamburger-line:nth-child(3) {
				transform: none;
			}
			
			.center-section {
				flex: 1;
				display: flex;
				justify-content: center;
				align-items: center;
			}
			
			.logo-container {
				display: flex;
				align-items: center;
				gap: 10px;
			}
			
			.logo-image {
				width: 40px;
				height: 40px;
			}
			
			#logoImage {
				cursor: pointer;
				transition: opacity 0.2s ease;
			}
			
			#logoImage:hover {
				opacity: 0.8;
			}
			
			.logo-text {
				font-size: 24px;
				font-weight: 600;
				color: #4A90E2;
				letter-spacing: -0.5px;
			}
			
			.right-section {
				display: flex;
				align-items: center;
				gap: 15px;
				min-width: 180px;
				justify-content: flex-end;
			}
			
			.notification-container {
				position: relative;
			}
			
			.notification-icon {
				width: 32px;
				height: 32px;
				cursor: pointer;
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 20px;
				color: #666;
				position: relative;
			}
			
			.notification-badge {
				position: absolute;
				top: -5px;
				right: -5px;
				background: #ff4444;
				color: white;
				border-radius: 50%;
				width: 18px;
				height: 18px;
				font-size: 11px;
				display: flex;
				align-items: center;
				justify-content: center;
				font-weight: bold;
			}
			
			/* ê¸°ì¡´ ì•Œë¦¼ ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ì€ ìƒˆë¡œìš´ ëª¨ë‹¬ë¡œ ëŒ€ì²´ë¨ */
			
			.user-container {
				position: relative;
			}
			
			.user-info {
				display: flex;
				align-items: center;
				gap: 8px;
				cursor: pointer;
				padding: 6px 12px;
				border-radius: 20px;
				transition: background-color 0.2s;
			}
			
			.user-info:hover {
				background: rgba(0,0,0,0.05);
			}
			
			.user-details {
				text-align: right;
			}
			
			.user-name {
				font-size: 14px;
				font-weight: 600;
				color: #333;
				line-height: 1.2;
			}
			
			.user-role {
				font-size: 12px;
				color: #666;
				line-height: 1.2;
			}
			
			.dropdown-arrow {
				font-size: 12px;
				color: #666;
				margin-left: 4px;
			}
			
			.user-dropdown {
				position: absolute;
				top: 45px;
				right: 0;
				width: 150px;
				background: white;
				border-radius: 8px;
				box-shadow: 0 4px 20px rgba(0,0,0,0.15);
				border: 1px solid #e0e0e0;
				z-index: 1002;
				display: none;
				overflow: hidden;
			}
			
			.user-dropdown.show {
				display: block !important;
			}
			
			.user-menu-item {
				padding: 12px 20px;
				color: #333;
				font-size: 14px;
				cursor: pointer;
				transition: background-color 0.2s;
				display: flex;
				align-items: center;
				gap: 8px;
			}
			
			.user-menu-item:hover {
				background: #f8f9fa;
			}
			
			.user-menu-item.logout {
				color: #dc3545;
			}
			
			.user-menu-item.logout:hover {
				background: #fff5f5;
			}
		</style>
		<script lazy="false" type="text/javascript"><![CDATA[
scwin.sidebarVisible = false;
scwin.notificationVisible = false;
scwin.userMenuVisible = false;

// ========== ì•Œë¦¼ ì‹œìŠ¤í…œ ì„¤ì • ìƒìˆ˜ ==========
scwin.CONFIG = {
    MODAL: {
        ID: "header_notification_modal",
        MAX_WIDTH: "700px",
        MAX_HEIGHT: "80%",
        Z_INDEX: 10000
    },
    STYLES: {
        COLORS: {
            INFO: "#E3F2FD",
            WORK: "#E8F5E8", 
            WARNING: "#FFF3E0",
            DEFAULT: "#F5F5F5",
            BORDER: "#2196F3",
            READ_BG: "#FFFFFF",
            UNREAD_BG: "#F0F8FF",
            READ_TEXT: "#666666",
            UNREAD_TEXT: "#333333",
            READ_BORDER: "#E0E0E0",
            UNREAD_BORDER: "#2196F3"
        },
        GRADIENT: "linear-gradient(135deg, #2196F3, #1976D2)"
    },
    ICONS: {
        INFO: "",
        WORK: "",
        WARNING: "",
        DEFAULT: "",
        UNREAD: "",
        BELL: "",
        CALENDAR: "",
        EMPTY: "",
        SUMMARY: "",
        TIP: ""
    },
    TIMINGS: {
        MARK_READ_DELAY: 3000,
        REFRESH_DELAY: 100,
        BADGE_UPDATE_DELAY: 500
    }
};

// ========== ì•Œë¦¼ ë°ì´í„° (í—¤ë” ê´€ë ¨) ==========
scwin.notifications = [
    {
        id: "header_noti_1",
        title: "ì‹œìŠ¤í…œ ì•Œë¦¼", 
        message: "ìƒˆë¡œìš´ ì—…ë°ì´íŠ¸ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.",
        type: "info",
        createDate: "2025-01-15 09:00:00",
        isRead: false
    },
    {
        id: "header_noti_2",
        title: "ê·¼ë¬´í‘œ í™•ì •",
        message: "7ì›” ê·¼ë¬´í‘œê°€ í™•ì •ë˜ì—ˆìŠµë‹ˆë‹¤. í™•ì¸í•´ ì£¼ì„¸ìš”.", 
        type: "work",
        createDate: "2025-01-15 10:30:00",
        isRead: false
    },
    {
        id: "header_noti_3", 
        title: "ì‹œìŠ¤í…œ ì ê²€",
        message: "ì˜¤ëŠ˜ ë°¤ 12ì‹œë¶€í„° 2ì‹œê¹Œì§€ ì‹œìŠ¤í…œ ì ê²€ì´ ì˜ˆì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.",
        type: "warning",
        createDate: "2025-01-15 11:45:00", 
        isRead: true
    },
    {
        id: "header_noti_4",
        title: "ìƒˆë¡œìš´ ê¸°ëŠ¥",
        message: "ì•Œë¦¼ ì„¼í„° ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. í—¤ë”ì˜ ì•Œë¦¼ ì•„ì´ì½˜ì„ í´ë¦­í•´ë³´ì„¸ìš”.",
        type: "info", 
        createDate: "2025-01-15 14:20:00",
        isRead: true
    }
];

// ========== ì•Œë¦¼ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ==========
// ì•Œë¦¼ íƒ€ì…ì— ë”°ë¥¸ ì•„ì´ì½˜ê³¼ ìƒ‰ìƒ ê°€ì ¸ì˜¤ê¸°
scwin.getNotificationStyle = function(type) {
    switch(type) {
        case "info":
            return {
                icon: scwin.CONFIG.ICONS.INFO,
                bgColor: scwin.CONFIG.STYLES.COLORS.INFO
            };
        case "work":
            return {
                icon: scwin.CONFIG.ICONS.WORK,
                bgColor: scwin.CONFIG.STYLES.COLORS.WORK
            };
        case "warning":
            return {
                icon: scwin.CONFIG.ICONS.WARNING,
                bgColor: scwin.CONFIG.STYLES.COLORS.WARNING
            };
        default:
            return {
                icon: scwin.CONFIG.ICONS.DEFAULT,
                bgColor: scwin.CONFIG.STYLES.COLORS.DEFAULT
            };
    }
};

// ë¯¸ì½ì€ ì•Œë¦¼ ê°œìˆ˜ ê³„ì‚°
scwin.getUnreadCount = function() {
    var count = 0;
    for (var i = 0; i < scwin.notifications.length; i++) {
        if (!scwin.notifications[i].isRead) {
            count++;
        }
    }
    return count;
};

// ì•Œë¦¼ HTML ìƒì„± (ëª¨ë‹¬ìš©)
scwin.generateNotificationHTML = function() {
    var notificationHtml = "";
    
    if (scwin.notifications.length === 0) {
        return "<div style='text-align: center; color: #999; font-size: 16px; padding: 40px;'>" + 
               scwin.CONFIG.ICONS.EMPTY + " ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>";
    }
    
    for (var i = 0; i < scwin.notifications.length; i++) {
        var notification = scwin.notifications[i];
        var style = scwin.getNotificationStyle(notification.type);
        var readStatus = notification.isRead ? "" : " " + scwin.CONFIG.ICONS.UNREAD + " (ë¯¸ì½ìŒ)";
        
        // ì½ìŒ/ë¯¸ì½ìŒì— ë”°ë¥¸ ìŠ¤íƒ€ì¼ ì„¤ì •
        var bgColor = notification.isRead ? scwin.CONFIG.STYLES.COLORS.READ_BG : scwin.CONFIG.STYLES.COLORS.UNREAD_BG;
        var textColor = notification.isRead ? scwin.CONFIG.STYLES.COLORS.READ_TEXT : scwin.CONFIG.STYLES.COLORS.UNREAD_TEXT;
        var borderColor = notification.isRead ? scwin.CONFIG.STYLES.COLORS.READ_BORDER : scwin.CONFIG.STYLES.COLORS.UNREAD_BORDER;
        var fontWeight = notification.isRead ? "normal" : "bold";
        var boxShadow = notification.isRead ? "0 1px 3px rgba(0,0,0,0.1)" : "0 2px 8px rgba(33,150,243,0.2)";
        
        notificationHtml += 
            "<div onclick='scwin.markNotificationAsRead(\"" + notification.id + "\")' style='margin-bottom: 15px; padding: 15px; background-color: " + bgColor + "; border-radius: 8px; border-left: 5px solid " + borderColor + "; box-shadow: " + boxShadow + "; transition: all 0.3s ease; cursor: " + (notification.isRead ? "default" : "pointer") + ";'>" +
            "<div style='font-size: 16px; font-weight: " + fontWeight + "; color: " + textColor + "; margin-bottom: 8px;'>" +
            style.icon + " " + notification.title + readStatus + "</div>" +
            "<div style='font-size: 14px; color: " + (notification.isRead ? "#777" : "#555") + "; margin-bottom: 8px; line-height: 1.4;'>" + notification.message + "</div>" +
            "<div style='font-size: 12px; color: " + (notification.isRead ? "#999" : "#888") + "; text-align: right;'>" + scwin.CONFIG.ICONS.CALENDAR + " " + notification.createDate + "</div>" +
            "</div>";
    }
    
    return notificationHtml;
};

// ì•Œë¦¼ ë©”ì‹œì§€ ìƒì„± (Alertìš©)
scwin.generateAlertMessage = function() {
    var unreadCount = scwin.getUnreadCount();
    var message = scwin.CONFIG.ICONS.BELL + " [í—¤ë” ì•Œë¦¼ ì„¼í„°] " + scwin.CONFIG.ICONS.BELL + "\n\n";
    
    for (var i = 0; i < scwin.notifications.length; i++) {
        var notification = scwin.notifications[i];
        var style = scwin.getNotificationStyle(notification.type);
        var statusText = notification.isRead ? "[ì½ìŒ]" : "[ë¯¸ì½ìŒ]";
        
        message += "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n";
        message += (i + 1) + ". " + style.icon + " " + notification.title + " " + statusText + "\n";
        message += "ë‚´ìš©: " + notification.message + "\n";
        message += "ì‹œê°„: " + notification.createDate + "\n\n";
    }
    
    message += "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n";
    message += scwin.CONFIG.ICONS.SUMMARY + " ìš”ì•½: ì´ " + scwin.notifications.length + "ê°œ ì•Œë¦¼ (ë¯¸ì½ìŒ " + unreadCount + "ê°œ)\n\n";
    message += scwin.CONFIG.ICONS.TIP + " ì´ ì°½ì„ ë‹«ìœ¼ë©´ ëª¨ë“  ì•Œë¦¼ì´ ì½ìŒ ì²˜ë¦¬ë©ë‹ˆë‹¤.";
    
    return message;
};

// ========== ì•Œë¦¼ ëª¨ë‹¬ ê´€ë¦¬ í•¨ìˆ˜ ==========
// ì•Œë¦¼ ëª¨ë‹¬ í‘œì‹œ
scwin.showNotificationModal = function() {
    console.log("=== í—¤ë” ì•Œë¦¼ ëª¨ë‹¬ í‘œì‹œ ì‹œë„ ===");
    
    try {
        // ë¨¼ì € ì•Œë¦¼ ë°ì´í„° í™•ì¸
        console.log("í˜„ì¬ ì•Œë¦¼ ê°œìˆ˜:", scwin.notifications.length);
        
        // DOM ê¸°ë°˜ ì»¤ìŠ¤í…€ ëª¨ë‹¬ë¡œ ì§ì ‘ í‘œì‹œ
        scwin.showCustomModal();
        
    } catch (e) {
        console.log("ëª¨ë‹¬ í‘œì‹œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", e.message);
        console.log("alertë¡œ ëŒ€ì²´ í‘œì‹œ");
        scwin.showAlertNotification();
    }
};

// ì»¤ìŠ¤í…€ DOM ëª¨ë‹¬ë¡œ í‘œì‹œ
scwin.showCustomModal = function() {
    console.log("=== í—¤ë” ì»¤ìŠ¤í…€ ëª¨ë‹¬ ìƒì„± ì‹œì‘ ===");
    
    try {
        // ê¸°ì¡´ ëª¨ë‹¬ì´ ìˆìœ¼ë©´ ì œê±°
        var existingModal = document.getElementById(scwin.CONFIG.MODAL.ID);
        if (existingModal) {
            existingModal.remove();
        }
        
        var unreadCount = scwin.getUnreadCount();
        var notificationHtml = scwin.generateNotificationHTML();
        
        console.log("ì•Œë¦¼ HTML ìƒì„± ì™„ë£Œ, ì´ " + scwin.notifications.length + "ê°œ");
        
        // ëª¨ë‹¬ HTML ìƒì„±
        var modalHtml = 
            "<div id='" + scwin.CONFIG.MODAL.ID + "' style='position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: " + scwin.CONFIG.MODAL.Z_INDEX + "; display: flex; justify-content: center; align-items: center;'>" +
            "<div style='background: white; border-radius: 12px; width: 90%; max-width: " + scwin.CONFIG.MODAL.MAX_WIDTH + "; max-height: " + scwin.CONFIG.MODAL.MAX_HEIGHT + "; box-shadow: 0 10px 30px rgba(0,0,0,0.3); overflow: hidden;'>" +
            
            // í—¤ë”
            "<div style='background: #1C3D6B; color: white; padding: 20px; text-align: center;'>" +
            "<h2 style='margin: 0; font-size: 20px; font-weight: bold;'>" + scwin.CONFIG.ICONS.BELL + " í—¤ë” ì•Œë¦¼ ì„¼í„°</h2>" +
            "<p style='margin: 5px 0 0 0; font-size: 14px; opacity: 0.9;'>ì´ " + scwin.notifications.length + "ê°œ ì•Œë¦¼" + (unreadCount > 0 ? " (" + scwin.CONFIG.ICONS.UNREAD + "ë¯¸ì½ìŒ " + unreadCount + "ê°œ)" : "") + "</p>" +
            "</div>" +
            
            // ë‚´ìš©
            "<div style='padding: 20px; max-height: 400px; overflow-y: auto;'>" +
            notificationHtml +
            "</div>" +
            
            // ë²„íŠ¼ ì˜ì—­
            "<div style='border-top: 1px solid #eee; padding: 15px 20px; text-align: right; background-color: #f9f9f9;'>" +
            "<button onclick='scwin.addTestNotification()' style='background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 6px; margin-right: 10px; cursor: pointer; font-size: 14px;'>âœ¨ í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ì¶”ê°€</button>" +
            "<button onclick='scwin.closeCustomModal()' style='background: #f44336; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px;'>âŒ ë‹«ê¸°</button>" +
            "</div>" +
            
            "</div>" +
            "</div>";
        
        // DOMì— ì¶”ê°€
        document.body.insertAdjacentHTML('beforeend', modalHtml);
        
        console.log("í—¤ë” ì»¤ìŠ¤í…€ ëª¨ë‹¬ ìƒì„± ì™„ë£Œ");
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        scwin.attachModalEventListeners();
        
        // ìë™ ì½ìŒ ì²˜ë¦¬ (ì‹œê°„ì„ ëŠ˜ë ¤ì„œ ì‚¬ìš©ìê°€ ê°œë³„ í´ë¦­í•  ì‹œê°„ í™•ë³´)
        setTimeout(function() {
            scwin.markAllAsRead();
        }, 10000); // 10ì´ˆë¡œ ë³€ê²½
        
        console.log("=== í—¤ë” ì»¤ìŠ¤í…€ ëª¨ë‹¬ í‘œì‹œ ì™„ë£Œ ===");
        
    } catch (e) {
        console.log("ì»¤ìŠ¤í…€ ëª¨ë‹¬ ìƒì„± ì¤‘ ì˜¤ë¥˜:", e.message);
        scwin.showAlertNotification();
    }
};

// Alertë¡œ ì•Œë¦¼ í‘œì‹œ (ëŒ€ì²´ ë°©ë²•)
scwin.showAlertNotification = function() {
    console.log("=== Alertë¡œ í—¤ë” ì•Œë¦¼ í‘œì‹œ ì‹œì‘ ===");
    
    try {
        var message = scwin.generateAlertMessage();
        var unreadCount = scwin.getUnreadCount();
        
        console.log("Alert ì°½ í‘œì‹œ, ë¯¸ì½ìŒ " + unreadCount + "ê°œ");
        alert(message);
        
        // 1ì´ˆ í›„ ëª¨ë“  ì•Œë¦¼ì„ ì½ìŒ ì²˜ë¦¬
        setTimeout(function() {
            scwin.markAllAsRead();
        }, 1000);
        
        console.log("=== Alert í—¤ë” ì•Œë¦¼ í‘œì‹œ ì™„ë£Œ ===");
        
    } catch (e) {
        console.log("Alert í‘œì‹œ ì¤‘ ì˜¤ë¥˜:", e.message);
        // ìµœí›„ì˜ ìˆ˜ë‹¨
        alert("ì•Œë¦¼ í‘œì‹œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\ní˜„ì¬ " + scwin.notifications.length + "ê°œì˜ ì•Œë¦¼ì´ ìˆìŠµë‹ˆë‹¤.\nê°œë°œì ë„êµ¬ ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
    }
};

// ========== ì•Œë¦¼ ê´€ë¦¬ í•¨ìˆ˜ ==========
// ëª¨ë“  ì•Œë¦¼ì„ ì½ìŒ ì²˜ë¦¬
scwin.markAllAsRead = function() {
    var hasChanges = false;
    
    for (var i = 0; i < scwin.notifications.length; i++) {
        if (!scwin.notifications[i].isRead) {
            scwin.notifications[i].isRead = true;
            hasChanges = true;
        }
    }
    
    if (hasChanges) {
        scwin.updateNotificationBadge();
        console.log("ëª¨ë“  í—¤ë” ì•Œë¦¼ì„ ì½ìŒ ì²˜ë¦¬ ì™„ë£Œ");
    }
};

// ê°œë³„ ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬
scwin.markNotificationAsRead = function(notificationId) {
    for (var i = 0; i < scwin.notifications.length; i++) {
        if (scwin.notifications[i].id === notificationId && !scwin.notifications[i].isRead) {
            scwin.notifications[i].isRead = true;
            scwin.updateNotificationBadge();
            console.log("ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬:", notificationId);
            
            // ëª¨ë‹¬ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ìƒ‰ìƒ ë³€ê²½
            scwin.refreshModal();
            return true;
        }
    }
    return false;
};

// ì•Œë¦¼ ë°°ì§€ ì—…ë°ì´íŠ¸ (í—¤ë”ìš©)
scwin.updateNotificationBadge = function() {
    try {
        var unreadCount = scwin.getUnreadCount();
        
        // ë²„íŠ¼ ì°¾ê¸° (ìºì‹±)
        if (!scwin._btnAlarmCache) {
            scwin._btnAlarmCache = $w.getComponentById("alarm") || document.getElementById("alarm");
        }
        
        var btnAlarm = scwin._btnAlarmCache;
        if (!btnAlarm) {
            console.log("í—¤ë” ì•Œë¦¼ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
            return;
        }
        
        // ë°°ì§€ ìš”ì†Œ ì°¾ê¸°
        var badgeElement = document.getElementById("notificationBadge");
        var countElement = document.getElementById("notificationCount");
        
        // í˜„ì¬ ìƒíƒœì™€ ë¹„êµí•˜ì—¬ í•„ìš”í•œ ê²½ìš°ë§Œ ì—…ë°ì´íŠ¸
        var shouldShowBadge = unreadCount > 0;
        var currentlyShowingBadge = btnAlarm._badgeActive || false;
        
        if (shouldShowBadge !== currentlyShowingBadge) {
            if (shouldShowBadge) {
                // ë¯¸ì½ì€ ì•Œë¦¼ì´ ìˆìœ¼ë©´ ë¹¨ê°„ í…Œë‘ë¦¬
                var badgeStyle = "border: 3px solid #FF0000; border-radius: 50%; box-shadow: 0 0 10px #FF0000;";
                if (btnAlarm.setStyle) {
                    btnAlarm.setStyle(badgeStyle);
                } else {
                    btnAlarm.style.border = "3px solid #FF0000";
                    btnAlarm.style.borderRadius = "50%";
                    btnAlarm.style.boxShadow = "0 0 10px #FF0000";
                }
                btnAlarm._badgeActive = true;
                
                // ë°°ì§€ í‘œì‹œ ë° ìˆ«ì ì—…ë°ì´íŠ¸
                if (badgeElement) {
                    badgeElement.style.display = "block";
                }
                if (countElement) {
                    countElement.setValue(unreadCount.toString());
                }
                
                console.log("í—¤ë” ì•Œë¦¼ ë°°ì§€ í™œì„±í™” (" + unreadCount + "ê°œ ë¯¸ì½ìŒ)");
            } else {
                // ë¯¸ì½ì€ ì•Œë¦¼ì´ ì—†ìœ¼ë©´ ì›ë˜ ìƒíƒœ
                if (btnAlarm.setStyle) {
                    btnAlarm.setStyle("border: none; box-shadow: none;");
                } else {
                    btnAlarm.style.border = "none";
                    btnAlarm.style.boxShadow = "none";
                }
                btnAlarm._badgeActive = false;
                
                // ë°°ì§€ ìˆ¨ê¸°ê¸°
                if (badgeElement) {
                    badgeElement.style.display = "none";
                }
                
                console.log("í—¤ë” ì•Œë¦¼ ë°°ì§€ ë¹„í™œì„±í™”");
            }
        } else if (shouldShowBadge && countElement) {
            // ë°°ì§€ê°€ ì´ë¯¸ í‘œì‹œë˜ì–´ ìˆì§€ë§Œ ìˆ«ìê°€ ë‹¤ë¥¸ ê²½ìš° ì—…ë°ì´íŠ¸
            countElement.setValue(unreadCount.toString());
        }
        
    } catch (e) {
        console.log("ë°°ì§€ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜:", e.message);
    }
};

// í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ì¶”ê°€ (í—¤ë” ê´€ë ¨)
scwin.addTestNotification = function() {
    var testMessages = [
        {
            title: "ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸",
            message: "ìƒˆë¡œìš´ ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. í™•ì¸í•´ ì£¼ì„¸ìš”.",
            type: "info"
        },
        {
            title: "ê·¼ë¬´í‘œ ë³€ê²½",
            message: "ë‹¤ìŒ ì£¼ ê·¼ë¬´í‘œê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.",
            type: "work"
        },
        {
            title: "ì‹œìŠ¤í…œ ì ê²€",
            message: "ì˜¤ëŠ˜ ë°¤ ì‹œìŠ¤í…œ ì ê²€ì´ ì˜ˆì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.",
            type: "warning"
        },
        {
            title: "ìƒˆë¡œìš´ ì•Œë¦¼",
            message: "ì•Œë¦¼ ì„¼í„° ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.",
            type: "info"
        }
    ];
    
    var randomIndex = Math.floor(Math.random() * testMessages.length);
    var testMessage = testMessages[randomIndex];
    
    // ìƒˆ ì•Œë¦¼ ì¶”ê°€
    var newNotification = {
        id: "test_" + new Date().getTime(),
        title: testMessage.title,
        message: testMessage.message,
        type: testMessage.type,
        createDate: new Date().toLocaleString(),
        isRead: false
    };
    
    scwin.notifications.unshift(newNotification); // ë§¨ ì•ì— ì¶”ê°€
    
    console.log("í—¤ë” í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ì¶”ê°€:", testMessage.title);
    
    // ë°°ì§€ ì—…ë°ì´íŠ¸
    scwin.updateNotificationBadge();
    
    // ëª¨ë‹¬ ìƒˆë¡œê³ ì¹¨ (ì„±ëŠ¥ ìµœì í™”)
    scwin.refreshModal();
};

// ëª¨ë‹¬ ìƒˆë¡œê³ ì¹¨ (ì„±ëŠ¥ ìµœì í™”)
scwin.refreshModal = function() {
    var existingModal = document.getElementById(scwin.CONFIG.MODAL.ID);
    if (existingModal) {
        scwin.closeCustomModal();
        setTimeout(function() {
            scwin.showNotificationModal();
        }, scwin.CONFIG.TIMINGS.REFRESH_DELAY);
    }
};

// ì»¤ìŠ¤í…€ ëª¨ë‹¬ ë‹«ê¸° (ê°œì„ ëœ ë²„ì „)
scwin.closeCustomModal = function() {
    console.log("í—¤ë” ì»¤ìŠ¤í…€ ëª¨ë‹¬ ë‹«ê¸°");
    try {
        var modal = document.getElementById(scwin.CONFIG.MODAL.ID);
        if (modal) {
            modal.remove();
            console.log("í—¤ë” ì»¤ìŠ¤í…€ ëª¨ë‹¬ ì œê±° ì™„ë£Œ");
        }
    } catch (e) {
        console.log("ëª¨ë‹¬ ë‹«ê¸° ì¤‘ ì˜¤ë¥˜:", e.message);
    }
};

// ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
scwin.attachModalEventListeners = function() {
    var modal = document.getElementById(scwin.CONFIG.MODAL.ID);
    if (!modal) return;
    
    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            scwin.closeCustomModal();
        }
    });
    
    // ESC í‚¤ë¡œ ë‹«ê¸° (í•œ ë²ˆë§Œ ë“±ë¡)
    if (!scwin._escListenerAttached) {
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.getElementById(scwin.CONFIG.MODAL.ID)) {
                scwin.closeCustomModal();
            }
        });
        scwin._escListenerAttached = true;
    }
};

scwin.onpageload = function() {
	console.log("í—¤ë” ì´ˆê¸°í™” ì™„ë£Œ");
	// ì´ˆê¸° ìƒíƒœ ì„¤ì •
	scwin.hideUserMenu();
	
	// ì•Œë¦¼ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
	setTimeout(function() {
		try {
			console.log("í—¤ë” ì•Œë¦¼ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...");
			if (scwin.updateNotificationBadge) {
				scwin.updateNotificationBadge();
				console.log("í—¤ë” ì•Œë¦¼ ë°°ì§€ ì´ˆê¸°í™” ì™„ë£Œ");
			}
		} catch (e) {
			console.log("ì•Œë¦¼ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜:", e.message);
		}
	}, 1000);
};

scwin.toggleSidebar = function() {
	console.log("í–„ë²„ê±° ì•„ì´ì½˜ í´ë¦­ë¨ - ì‚¬ì´ë“œë°” í† ê¸€ ì‹œë„");
	
	var success = false;
	
	// ë°©ë²• 1: ë¶€ëª¨ í”„ë ˆì„ì—ì„œ ì§ì ‘ í•¨ìˆ˜ í˜¸ì¶œ
	try {
		if (window.parent && window.parent.scwin && window.parent.scwin.toggleSidebar) {
			window.parent.scwin.toggleSidebar();
			console.log("âœ… ë°©ë²• 1 ì„±ê³µ: parent.scwin.toggleSidebar");
			success = true;
		}
	} catch (e) {
		console.log("ë°©ë²• 1 ì‹¤íŒ¨:", e);
	}
	
	// ë°©ë²• 2: ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡ëœ í•¨ìˆ˜ í˜¸ì¶œ
	if (!success) {
		try {
			if (window.parent && window.parent.toggleSidebarFromHeader) {
				window.parent.toggleSidebarFromHeader();
				console.log("âœ… ë°©ë²• 2 ì„±ê³µ: parent.toggleSidebarFromHeader");
				success = true;
			}
		} catch (e) {
			console.log("ë°©ë²• 2 ì‹¤íŒ¨:", e);
		}
	}
	
	// ë°©ë²• 3: ìµœìƒìœ„ í”„ë ˆì„ì—ì„œ í•¨ìˆ˜ ì°¾ê¸°
	if (!success) {
		try {
			if (window.top && window.top.scwin && window.top.scwin.toggleSidebar) {
				window.top.scwin.toggleSidebar();
				console.log("âœ… ë°©ë²• 3 ì„±ê³µ: top.scwin.toggleSidebar");
				success = true;
			}
		} catch (e) {
			console.log("ë°©ë²• 3 ì‹¤íŒ¨:", e);
		}
	}
	
	// ë°©ë²• 4: postMessage ì‚¬ìš©
	if (!success) {
		try {
			window.parent.postMessage({
				action: 'toggleSidebar',
				source: 'header'
			}, '*');
			console.log("âœ… ë°©ë²• 4 ì„±ê³µ: postMessage ì „ì†¡");
			success = true;
		} catch (e) {
			console.log("ë°©ë²• 4 ì‹¤íŒ¨:", e);
		}
	}
	
	if (!success) {
		console.error("âŒ ëª¨ë“  í†µì‹  ë°©ë²• ì‹¤íŒ¨");
		alert("ì‚¬ì´ë“œë°” í† ê¸€ ê¸°ëŠ¥ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.");
	}
};

// í–„ë²„ê±° ì•„ì´ì½˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
scwin.updateHamburgerIcon = function(isVisible) {
	try {
		var hamburgerMenu = document.querySelector('.hamburger-menu');
		if (hamburgerMenu) {
			if (isVisible) {
				// ì‚¬ì´ë“œë°”ê°€ ì—´ë ¤ìˆì„ ë•Œ â†’ X ëª¨ì–‘ ìœ ì§€ (collapsed í´ë˜ìŠ¤ ì œê±°)
				hamburgerMenu.classList.remove('collapsed');
				console.log("âœ… í–„ë²„ê±° ì•„ì´ì½˜: X ëª¨ì–‘ (ì‚¬ì´ë“œë°” ì—´ë¦¼)");
			} else {
				// ì‚¬ì´ë“œë°”ê°€ ë‹«í˜€ìˆì„ ë•Œ â†’ ì¼ë°˜ í–„ë²„ê±° ì•„ì´ì½˜ (collapsed í´ë˜ìŠ¤ ì¶”ê°€)
				hamburgerMenu.classList.add('collapsed');
				console.log("âœ… í–„ë²„ê±° ì•„ì´ì½˜: ì¼ë°˜ ëª¨ì–‘ (ì‚¬ì´ë“œë°” ë‹«í˜)");
			}
		}
	} catch (e) {
		console.error("í–„ë²„ê±° ì•„ì´ì½˜ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:", e);
	}
};

// ì•Œë¦¼ í† ê¸€ í•¨ìˆ˜ëŠ” alarm_onclickìœ¼ë¡œ ëŒ€ì²´ë¨

scwin.toggleUserMenu = function() {
	console.log("ì‚¬ìš©ì ë©”ë‰´ í† ê¸€ í•¨ìˆ˜ í˜¸ì¶œ");
	
	if (scwin.userMenuVisible) {
		scwin.hideUserMenu();
	} else {
		scwin.showUserMenu();
	}
};

scwin.showUserMenu = function() {
	console.log("ì‚¬ìš©ì ë©”ë‰´ í‘œì‹œ ì‹œë„");
	
	try {
		// ì „ì—­ jQuery ì‚¬ìš© ì‹œë„
		if (typeof $ !== 'undefined') {
			$('.user-dropdown').addClass('show');
			console.log("jQueryë¡œ ì‚¬ìš©ì ë©”ë‰´ í‘œì‹œë¨");
		} else if (typeof window.$ !== 'undefined') {
			window.$('.user-dropdown').addClass('show');
			console.log("window.jQueryë¡œ ì‚¬ìš©ì ë©”ë‰´ í‘œì‹œë¨");
		} else {
			// ìˆœìˆ˜ JavaScript ì‚¬ìš©
			var elements = document.querySelectorAll('.user-dropdown');
			for (var i = 0; i < elements.length; i++) {
				elements[i].classList.add('show');
			}
			console.log("ìˆœìˆ˜ JavaScriptë¡œ ì‚¬ìš©ì ë©”ë‰´ í‘œì‹œë¨");
		}
		scwin.userMenuVisible = true;
	} catch (e) {
		console.log("ì‚¬ìš©ì ë©”ë‰´ í‘œì‹œ ì˜¤ë¥˜:", e);
	}
};

scwin.hideUserMenu = function() {
	console.log("ì‚¬ìš©ì ë©”ë‰´ ìˆ¨ê¹€ ì‹œë„");
	
	try {
		// ì „ì—­ jQuery ì‚¬ìš© ì‹œë„
		if (typeof $ !== 'undefined') {
			$('.user-dropdown').removeClass('show');
			console.log("jQueryë¡œ ì‚¬ìš©ì ë©”ë‰´ ìˆ¨ê¹€");
		} else if (typeof window.$ !== 'undefined') {
			window.$('.user-dropdown').removeClass('show');
			console.log("window.jQueryë¡œ ì‚¬ìš©ì ë©”ë‰´ ìˆ¨ê¹€");
		} else {
			// ìˆœìˆ˜ JavaScript ì‚¬ìš©
			var elements = document.querySelectorAll('.user-dropdown');
			for (var i = 0; i < elements.length; i++) {
				elements[i].classList.remove('show');
			}
			console.log("ìˆœìˆ˜ JavaScriptë¡œ ì‚¬ìš©ì ë©”ë‰´ ìˆ¨ê¹€");
		}
		scwin.userMenuVisible = false;
	} catch (e) {
		console.log("ì‚¬ìš©ì ë©”ë‰´ ìˆ¨ê¹€ ì˜¤ë¥˜:", e);
	}
};

scwin.logout = function() {
	if (confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
		alert("ë¡œê·¸ì•„ì›ƒ ë©ë‹ˆë‹¤.");
		scwin.hideUserMenu();
		// ì—¬ê¸°ì— ì‹¤ì œ ë¡œê·¸ì•„ì›ƒ ë¡œì§ ì¶”ê°€
	}
};

// ì™¸ë¶€ í´ë¦­ ì‹œ ë©”ë‰´ ë‹«ê¸°
scwin.closeMenus = function() {
	scwin.hideUserMenu();
};

// ë¡œê³  í´ë¦­ ì‹œ í™ˆìœ¼ë¡œ ì´ë™
scwin.goToHome = function() {
	try {
		console.log("ë¡œê³  í´ë¦­ - í™ˆìœ¼ë¡œ ì´ë™");
		window.location.href = "http://localhost:9093/InsWebApp/websquare/websquare.html?w2xPath=/InsWebApp/ui/layout/mkduty.xml";
	} catch (e) {
		console.error("í™ˆ ì´ë™ ì˜¤ë¥˜:", e);
		alert("í˜ì´ì§€ ì´ë™ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
	}
};

scwin.alarm_onclick = function(e) {
    console.log("=== í—¤ë” ì•Œë¦¼ ë²„íŠ¼ í´ë¦­ë¨ ===");
    
    try {
        console.log("í˜„ì¬ í—¤ë” ì•Œë¦¼ ê°œìˆ˜:", scwin.notifications.length);
        scwin.showNotificationModal();
    } catch (error) {
        console.log("ë²„íŠ¼ í´ë¦­ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:", error.message);
        scwin.showAlertNotification();
    }
};
]]></script>
	</head>
	<body ev:onpageload="scwin.onpageload" ev:onclick="scwin.closeMenus">
		<xf:group class="header-container">
			<xf:group class="left-section">
				<xf:group class="hamburger-menu" ev:onclick="scwin.toggleSidebar">
					<xf:group class="hamburger-line"></xf:group>
					<xf:group class="hamburger-line"></xf:group>
					<xf:group class="hamburger-line"></xf:group>
				</xf:group>
			</xf:group>
			
			<xf:group class="center-section">
				<xf:group class="logo-container">
                    <xf:image src="/InsWebApp/images/logo.png" style="width: 200px;height: 60px;cursor:pointer;" id="logoImage" ev:onclick="scwin.goToHome"></xf:image>
				</xf:group>
			</xf:group>
			
			<xf:group class="right-section">
				<xf:group class="notification-container">
					<xf:image src="/InsWebApp/images/jong.png" style="width: 20px;height: 20px;" id="alarm" ev:onclick="scwin.alarm_onclick"></xf:image>
				</xf:group>
				
				<xf:group class="user-container">
					<xf:group class="user-info" ev:onclick="scwin.toggleUserMenu">
						<xf:group class="user-details">
							<w2:textbox id="" class="user-name" label="ê¹€ê°„í˜¸" style="display:block;"></w2:textbox>
							<w2:textbox id="" class="user-role" label="ìˆ˜ê°„í˜¸ì‚¬" style="display:block;"></w2:textbox>
						</xf:group>
						<w2:textbox id="" class="dropdown-arrow" label="â–¼"></w2:textbox>
					</xf:group>

					<!-- ì‚¬ìš©ì ë“œë¡­ë‹¤ìš´ ë©”ë‰´ -->
					<xf:group id="userDropdown" class="user-dropdown" style="display:none; visibility:hidden; opacity:0;">
						<xf:group class="user-menu-item logout" ev:onclick="scwin.logout">
							<w2:textbox id="" label="ğŸšª" style="font-size:14px; color:#dc3545;"></w2:textbox>
							<w2:textbox id="" label="ë¡œê·¸ì•„ì›ƒ" style="font-size:14px; color:#dc3545;"></w2:textbox>
						</xf:group>
					</xf:group>
				</xf:group>
			</xf:group>
		</xf:group>
	</body>
</html>